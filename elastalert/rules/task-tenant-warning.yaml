name: tenant-archiving

type: flatline

index: aggregator-logs-%Y.%m.%d
use_strftime_index: true

#The maximum time between changes. After this time period, ElastAlert 2 will forget the old value of the compare_key field.
timeframe:
  weeks: 2

threshold: 1  # Moins de 1 hit = alerte

filter:
  - match_phrase:
      environment: "prod"
  - match_phrase:
      application: "task-scheduler"
  - bool:
      should:
        - match_phrase:
            task_name: "TENANT_WARNINGS_1"
        - match_phrase:
            task_name: "TENANT_WARNINGS_2"
      minimum_should_match: 1
  - match_phrase:
      task_status: "SUCCESS"

realert:
  hours: 24  # ‚¨ÖÔ∏è N‚Äôenvoie qu‚Äôun seul message toutes les 24h

alert:
  - slack

slack_webhook_url: "{{mattermost_webhook_elk_alert_url}}"
slack_msg_pretext: "üìõ **ALERTE PROD** : Une anomalie a √©t√© d√©tect√©e. Aucune notification de warning a √©t√© envoy√©e depuis 2 semaines"

slack_msg_color: danger
slack_username_override: "AlerteFacile"
slack_emoji_override: ":no_entry_sign:"
slack_text_string: "@nicolas.sagon, @romaric.haldenwang, @alix.deschamps *It's time to shine*"

slack_alert_fields:
  - title: Environnement
    value: "environment"
    short: true
  - title: T√¢che
    value: "task_name"
    short: true
  - title: Heure
    value: "@timestamp"
    short: false