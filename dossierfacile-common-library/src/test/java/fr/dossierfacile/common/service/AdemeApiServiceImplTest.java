package fr.dossierfacile.common.service;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;
import fr.dossierfacile.common.exceptions.AdemeApiBadRequestException;
import fr.dossierfacile.common.exceptions.AdemeApiInternalServerErrorException;
import fr.dossierfacile.common.exceptions.AdemeApiNotFoundException;
import fr.dossierfacile.common.exceptions.AdemeApiUnauthorizedException;
import fr.dossierfacile.common.model.AdemeResultModel;
import fr.dossierfacile.common.utils.TestHttpResponse;
import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.Test;
import org.mockito.Mockito;

import java.io.IOException;
import java.net.http.HttpClient;
import java.net.http.HttpResponse;

import static org.assertj.core.api.Assertions.assertThat;
import static org.junit.jupiter.api.Assertions.assertThrows;
import static org.mockito.Mockito.doReturn;

class AdemeApiServiceImplTest {

    private static final ObjectMapper objectMapper = new ObjectMapper();
    private static HttpClient client = Mockito.mock(HttpClient.class);

    private static final String ADEME_API_BASE_URL = "https://api.ademe.fr";
    private static final String ADEME_API_CLIENT_ID = "ademeApiClientId";
    private static final String ADEME_API_CLIENT_SECRET = "ademeApi";

    private final AdemeApiServiceImpl ademeApiService = new AdemeApiServiceImpl(
            ADEME_API_BASE_URL,
            ADEME_API_CLIENT_ID,
            ADEME_API_CLIENT_SECRET,
            objectMapper,
            client
    );

    @BeforeAll
    static void setUp() {
        objectMapper.registerModule(new JavaTimeModule());
    }

    @Test
    void shouldThrowRuntimeExceptionWhenHttpClientError() throws IOException, InterruptedException {
        Mockito.when(client.send(Mockito.any(), Mockito.any()))
                .thenThrow(new IOException("HTTP Client Error"));

        assertThrows(AdemeApiInternalServerErrorException.class, () -> ademeApiService.getDpeDetails("1234567890"));
    }

    @Test
    void shouldThrowAdemeApiNotFoundException() throws IOException, InterruptedException {
        HttpResponse<String> predictedResponse = new TestHttpResponse(404, "404 body");

        doReturn(predictedResponse).when(client).send(Mockito.any(), Mockito.any());

        assertThrows(AdemeApiNotFoundException.class, () -> ademeApiService.getDpeDetails("1234567890"));
    }

    @Test
    void shouldThrowAdemeApiUnauthorizedExceptionWhen401() throws IOException, InterruptedException {
        HttpResponse<String> predictedResponse = new TestHttpResponse(401, "401 body");

        doReturn(predictedResponse).when(client).send(Mockito.any(), Mockito.any());

        assertThrows(AdemeApiUnauthorizedException.class, () -> ademeApiService.getDpeDetails("1234567890"));
    }

    @Test
    void shouldThrowAdemeApiUnauthorizedExceptionWhen403() throws IOException, InterruptedException {
        HttpResponse<String> predictedResponse = new TestHttpResponse(403, "403 body");

        doReturn(predictedResponse).when(client).send(Mockito.any(), Mockito.any());

        assertThrows(AdemeApiUnauthorizedException.class, () -> ademeApiService.getDpeDetails("1234567890"));
    }

    @Test
    void shouldThrowAdemeApiBadRequestExceptionWhen400() throws IOException, InterruptedException {
        HttpResponse<String> predictedResponse = new TestHttpResponse(400, "400 body");

        doReturn(predictedResponse).when(client).send(Mockito.any(), Mockito.any());

        assertThrows(AdemeApiBadRequestException.class, () -> ademeApiService.getDpeDetails("1234567890"));

    }

    @Test
    void shouldThrowAdemeApiInternalServerErrorException() throws IOException, InterruptedException {
        HttpResponse<String> predictedResponse = new TestHttpResponse(500, "500 body");

        doReturn(predictedResponse).when(client).send(Mockito.any(), Mockito.any());

        assertThrows(AdemeApiInternalServerErrorException.class, () -> ademeApiService.getDpeDetails("1234567890"));
    }

    @Test
    void shouldReturnAdemeResultModelWhenSuccess() throws IOException, InterruptedException, AdemeApiBadRequestException, AdemeApiInternalServerErrorException, AdemeApiNotFoundException, AdemeApiUnauthorizedException {
        String expectedResponseBody = "{\"timestamp\":\"2025-06-10T11:58:12.777Z\",\"correlationId\":\"2efc6360-45f2-11f0-a406-06bc8cd7dc9b\",\"success\":true,\"consommationEnergieFinale\":121,\"dpe\":{\"numero_dpe\":\"2394E2534231D\",\"statut\":\"ACTIF\",\"administratif\":{\"dpe_a_remplacer\":null,\"reference_interne_projet\":\"116656\",\"motif_remplacement\":null,\"dpe_immeuble_associe\":null,\"enum_version_id\":\"2.2\",\"date_visite_diagnostiqueur\":\"2023-07-26\",\"date_etablissement_dpe\":\"2023-07-27\",\"enum_modele_dpe_id\":\"1\",\"diagnostiqueur\":{\"usr_logiciel_id\":\"26615\",\"version_logiciel\":\"LICIEL Diagnostics v4 [Version XML:261]\",\"version_moteur_calcul\":\"3cl_tribu_1.4.25.1\"},\"geolocalisation\":{\"numero_fiscal_local\":null,\"id_batiment_rnb\":null,\"rpls_log_id\":null,\"rpls_org_id\":null,\"idpar\":null,\"immatriculation_copropriete\":null,\"adresses\":{\"adresse_bien\":{\"adresse_brut\":\"44 Avenue Pierre Semard\",\"code_postal_brut\":\"94200\",\"nom_commune_brut\":\"IVRY-SUR-SEINE\",\"label_brut\":\"44 Avenue Pierre Semard 94200 IVRY-SUR-SEINE\",\"label_brut_avec_complement\":\"44 Avenue Pierre Semard 94200 IVRY-SUR-SEINE Etage RDC; Porte 2eme droite\",\"enum_statut_geocodage_ban_id\":\"1\",\"ban_date_appel\":\"2023-07-27\",\"ban_id\":\"94041_7170_00044\",\"ban_label\":\"44 Avenue Pierre Sémard 94200 Ivry-sur-Seine\",\"ban_housenumber\":\"44\",\"ban_street\":\"Avenue Pierre Sémard\",\"ban_citycode\":\"94041\",\"ban_postcode\":\"94200\",\"ban_city\":\"Ivry-sur-Seine\",\"ban_type\":\"housenumber\",\"ban_score\":\"0.70789999999999986\",\"ban_x\":\"654499.47\",\"ban_y\":\"6857863.65\",\"compl_nom_residence\":null,\"compl_ref_batiment\":\"116656\",\"compl_etage_appartement\":\"0\",\"compl_ref_cage_escalier\":null,\"compl_ref_logement\":\"Etage RDC; Porte 2eme droite\"}}}},\"logement\":{\"caracteristique_generale\":{\"enum_periode_construction_id\":\"1\",\"enum_methode_application_dpe_log_id\":\"2\",\"surface_habitable_logement\":\"15.13\",\"nombre_niveau_logement\":\"1\",\"hsp\":\"2.58\",\"nombre_appartement\":\"1\"},\"meteo\":{\"enum_zone_climatique_id\":\"1\",\"altitude\":\"33\",\"enum_classe_altitude_id\":\"1\",\"batiment_materiaux_anciens\":\"0\"},\"enveloppe\":{\"inertie\":{\"inertie_plancher_bas_lourd\":\"0\",\"inertie_plancher_haut_lourd\":\"0\",\"inertie_paroi_verticale_lourd\":\"0\",\"enum_classe_inertie_id\":\"4\"},\"mur_collection\":{\"mur\":{\"donnee_entree\":{\"description\":\"Mur  3 Sud, Est (p2) - Mur en briques creuses d'épaisseur ≤ 15 cm avec un doublage rapporté avec isolation intérieure (R=1,75m².K/W) donnant sur des circulations sans ouverture directe sur l'extérieur\",\"reference\":\"2023_07_26_11_11_48_5442025008350583(p2)\",\"reference_lnc\":\"LNC2023_07_26_11_11_48_5442025008350583(p2)\",\"tv_coef_reduction_deperdition_id\":\"83\",\"surface_aiu\":\"70.06\",\"surface_aue\":\"12.73\",\"enum_cfg_isolation_lnc_id\":\"2\",\"enum_type_adjacence_id\":\"14\",\"enum_orientation_id\":\"3\",\"surface_paroi_totale\":\"7.2\",\"surface_paroi_opaque\":\"7.2\",\"tv_umur0_id\":\"60\",\"epaisseur_structure\":\"15\",\"enum_materiaux_structure_mur_id\":\"10\",\"enum_methode_saisie_u0_id\":\"2\",\"enduit_isolant_paroi_ancienne\":\"0\",\"enum_type_doublage_id\":\"3\",\"enum_type_isolation_id\":\"3\",\"resistance_isolation\":\"1.75\",\"enum_methode_saisie_u_id\":\"6\"},\"donnee_intermediaire\":{\"b\":\"0.15\",\"umur\":\"0.43194390624189516\",\"umur0\":\"1.76955\"}}},\"plancher_bas_collection\":{\"plancher_bas\":{\"donnee_entree\":{\"description\":\"Plancher - Plancher avec ou sans remplissage donnant sur un sous-sol non chauffé avec isolation sous chape flottante (0,6 cm)\",\"reference\":\"2023_07_26_11_16_53_057425500515647\",\"reference_lnc\":null,\"tv_coef_reduction_deperdition_id\":\"6\",\"enum_type_adjacence_id\":\"6\",\"surface_paroi_opaque\":\"15.13\",\"tv_upb0_id\":\"2\",\"enum_type_plancher_bas_id\":\"2\",\"enum_methode_saisie_u0_id\":\"2\",\"enum_type_isolation_id\":\"3\",\"epaisseur_isolation\":\"0.6\",\"enum_methode_saisie_u_id\":\"3\",\"calcul_ue\":\"1\",\"perimetre_ue\":\"3.06\",\"surface_ue\":\"15.13\",\"ue\":\"0.30237278\"},\"donnee_intermediaire\":{\"b\":\"1\",\"upb\":\"1.2011834319526626\",\"upb_final\":\"0.30237278\",\"upb0\":\"1.45\"}}},\"plancher_haut_collection\":{\"plancher_haut\":{\"donnee_entree\":{\"description\":\"Plafond - Plafond avec ou sans remplissage donnant sur un local chauffé avec isolation intérieure\",\"reference\":\"2023_07_26_11_15_55_2292782003979785\",\"reference_lnc\":null,\"tv_coef_reduction_deperdition_id\":\"283\",\"enum_type_adjacence_id\":\"22\",\"surface_paroi_opaque\":\"15.13\",\"tv_uph0_id\":\"2\",\"enum_type_plancher_haut_id\":\"2\",\"enum_methode_saisie_u0_id\":\"2\",\"enum_type_isolation_id\":\"3\",\"resistance_isolation\":\"1.2\",\"enum_methode_saisie_u_id\":\"6\"},\"donnee_intermediaire\":{\"b\":\"0\",\"uph\":\"0.52919708029197077\",\"uph0\":\"1.45\"}}},\"baie_vitree_collection\":{\"baie_vitree\":{\"donnee_entree\":{\"description\":\"Fenêtre Sud - Fenêtres battantes pvc, orientées Sud, double vitrage à isolation renforcée\",\"reference\":\"2023_07_26_11_06_34_0250226007450601\",\"reference_paroi\":\"2023_07_26_11_03_03_893350200393603\",\"reference_lnc\":null,\"tv_coef_reduction_deperdition_id\":\"1\",\"enum_type_adjacence_id\":\"1\",\"surface_totale_baie\":\"1.8900000000000001\",\"nb_baie\":\"1\",\"tv_ug_id\":\"37\",\"enum_type_vitrage_id\":\"2\",\"enum_inclinaison_vitrage_id\":\"3\",\"enum_type_gaz_lame_id\":\"2\",\"epaisseur_lame\":\"20\",\"vitrage_vir\":\"1\",\"enum_methode_saisie_perf_vitrage_id\":\"13\",\"enum_type_materiaux_menuiserie_id\":\"5\",\"enum_type_baie_id\":\"4\",\"uw_saisi\":\"1.3\",\"double_fenetre\":\"0\",\"uw_1\":\"1.3\",\"sw_1\":\"0.38\",\"tv_deltar_id\":\"2\",\"tv_ujn_id\":\"66\",\"enum_type_fermeture_id\":\"3\",\"presence_protection_solaire_hors_fermeture\":\"0\",\"presence_retour_isolation\":\"0\",\"presence_joint\":\"0\",\"largeur_dormant\":\"5\",\"tv_sw_id\":\"111\",\"enum_type_pose_id\":\"2\",\"enum_orientation_id\":\"1\",\"tv_coef_masque_proche_id\":\"19\",\"masque_lointain_non_homogene_collection\":null},\"donnee_intermediaire\":{\"b\":\"1\",\"ug\":\"1.1\",\"uw\":\"1.3\",\"ujn\":\"1.2\",\"u_menuiserie\":\"1.2\",\"sw\":\"0.38\",\"fe1\":\"1\",\"fe2\":\"1\"},\"baie_vitree_double_fenetre\":null}},\"porte_collection\":{\"porte\":{\"donnee_entree\":{\"description\":\"Porte - Porte(s) bois opaque pleine\",\"reference\":\"2023_07_26_11_17_23_9399450002181311\",\"reference_paroi\":\"2023_07_26_11_11_48_5442025008350583\",\"reference_lnc\":\"LNC2023_07_26_11_17_23_9399450002181311\",\"enum_cfg_isolation_lnc_id\":\"2\",\"enum_type_adjacence_id\":\"14\",\"tv_coef_reduction_deperdition_id\":\"83\",\"surface_aiu\":\"70.06\",\"surface_aue\":\"12.73\",\"surface_porte\":\"1.78\",\"tv_uporte_id\":\"1\",\"enum_methode_saisie_uporte_id\":\"1\",\"enum_type_porte_id\":\"1\",\"nb_porte\":\"1\",\"largeur_dormant\":\"10\",\"presence_retour_isolation\":\"1\",\"presence_joint\":\"1\",\"enum_type_pose_id\":\"2\"},\"donnee_intermediaire\":{\"uporte\":\"3.5\",\"b\":\"0.15\"}}},\"ets_collection\":null,\"pont_thermique_collection\":null},\"ventilation_collection\":{\"ventilation\":{\"donnee_entree\":{\"surface_ventile\":\"15.13\",\"description\":\"Ventilation par ouverture des fenêtres\",\"reference\":\"2023_07_26_11_18_57_89292300004763126\",\"plusieurs_facade_exposee\":\"1\",\"tv_q4pa_conv_id\":\"10\",\"enum_methode_saisie_q4pa_conv_id\":\"1\",\"tv_debits_ventilation_id\":\"1\",\"enum_type_ventilation_id\":\"1\",\"ventilation_post_2012\":\"0\",\"ref_produit_ventilation\":null},\"donnee_intermediaire\":{\"q4pa_conv\":\"2\",\"conso_auxiliaire_ventilation\":\"0\",\"hperm\":\"6.17101\",\"hvent\":\"6.17304\"}}},\"climatisation_collection\":null,\"production_elec_enr\":null,\"installation_ecs_collection\":{\"installation_ecs\":{\"donnee_entree\":{\"description\":\"Ballon électrique à accumulation vertical (autres catégorie ou inconnue), contenance ballon 100 L\",\"reference\":\"2023_07_26_11_19_31_4363382009936148\",\"enum_cfg_installation_ecs_id\":\"1\",\"enum_type_installation_id\":\"1\",\"enum_methode_calcul_conso_id\":\"1\",\"surface_habitable\":\"15.13\",\"nombre_logement\":\"1\",\"rdim\":\"1\",\"nombre_niveau_installation_ecs\":\"1\",\"tv_rendement_distribution_ecs_id\":\"1\",\"enum_bouclage_reseau_ecs_id\":\"1\"},\"donnee_intermediaire\":{\"rendement_distribution\":\"0.93\",\"besoin_ecs\":\"717.60170872425\",\"besoin_ecs_depensier\":\"1012.33098195028\",\"conso_ecs\":\"1287.13474056371\",\"conso_ecs_depensier\":\"1604.04793758095\"},\"generateur_ecs_collection\":{\"generateur_ecs\":{\"donnee_entree\":{\"description\":\"Electrique - Ballon électrique à accumulation vertical (autres catégorie ou inconnue)\",\"reference\":\"Generateur:2023_07_26_11_19_31_4363382009936148\",\"data_complementaires\":null,\"reference_generateur_mixte\":null,\"enum_type_generateur_ecs_id\":\"69\",\"ref_produit_generateur_ecs\":null,\"enum_usage_generateur_id\":\"2\",\"enum_type_energie_id\":\"1\",\"enum_methode_saisie_carac_sys_id\":\"1\",\"tv_pertes_stockage_id\":\"2\",\"identifiant_reseau_chaleur\":null,\"enum_type_stockage_ecs_id\":\"3\",\"position_volume_chauffe\":\"1\",\"volume_stockage\":\"100\"},\"donnee_intermediaire\":{\"ratio_besoin_ecs\":\"1\",\"rendement_generation\":\"1\",\"conso_ecs\":\"1287.13474056371\",\"conso_ecs_depensier\":\"1604.04793758095\",\"rendement_stockage\":\"0.599482\"}}}}},\"installation_chauffage_collection\":{\"installation_chauffage\":{\"donnee_entree\":{\"description\":\"Radiateur électrique à fluide caloporteur (modélisé comme un radiateur NFC, NF** et NF***) avec programmateur avec réduit (système individuel)\",\"reference\":\"2023_07_26_11_19_00_9100280003983623\",\"surface_chauffee\":\"1.94\",\"rdim\":\"1\",\"nombre_niveau_installation_ch\":\"1\",\"enum_cfg_installation_ch_id\":\"1\",\"enum_type_installation_id\":\"1\",\"enum_methode_calcul_conso_id\":\"1\"},\"donnee_intermediaire\":{\"besoin_ch\":\"70.1708193265646\",\"besoin_ch_depensier\":\"95.5003045445432\",\"conso_ch\":\"66.9182020063492\",\"conso_ch_depensier\":\"91.0735934468457\"},\"emetteur_chauffage_collection\":{\"emetteur_chauffage\":{\"donnee_entree\":{\"description\":null,\"reference\":\"Emetteur:2023_07_26_11_19_00_9100280003983623#1\",\"surface_chauffee\":\"1.94\",\"tv_rendement_emission_id\":\"2\",\"tv_rendement_distribution_ch_id\":\"1\",\"tv_rendement_regulation_id\":\"2\",\"enum_type_emission_distribution_id\":\"3\",\"tv_intermittence_id\":\"126\",\"reseau_distribution_isole\":\"0\",\"enum_equipement_intermittence_id\":\"3\",\"enum_type_regulation_id\":\"2\",\"enum_periode_installation_emetteur_id\":\"1\",\"enum_type_chauffage_id\":\"1\",\"enum_temp_distribution_ch_id\":\"1\",\"enum_lien_generateur_emetteur_id\":\"1\"},\"donnee_intermediaire\":{\"i0\":\"0.88\",\"rendement_emission\":\"0.97\",\"rendement_distribution\":\"1\",\"rendement_regulation\":\"0.99\"}}},\"generateur_chauffage_collection\":{\"generateur_chauffage\":{\"donnee_entree\":{\"description\":\"Electrique - Radiateur électrique à accumulation\",\"reference\":\"Generateur:2023_07_26_11_19_00_9100280003983623#1\",\"data_complementaires\":null,\"reference_generateur_mixte\":null,\"ref_produit_generateur_ch\":\"Sans Objet\",\"enum_type_generateur_ch_id\":\"104\",\"enum_usage_generateur_id\":\"1\",\"enum_type_energie_id\":\"1\",\"position_volume_chauffe\":\"1\",\"tv_rendement_generation_id\":\"29\",\"identifiant_reseau_chaleur\":null,\"enum_methode_saisie_carac_sys_id\":\"1\",\"enum_lien_generateur_emetteur_id\":\"1\"},\"donnee_intermediaire\":{\"rendement_generation\":\"1\",\"conso_ch\":\"66.9182020063492\",\"conso_ch_depensier\":\"91.0735934468457\"}}}}},\"sortie\":{\"deperdition\":{\"hvent\":\"6.1730400000000012\",\"hperm\":\"6.1710119156990251\",\"deperdition_renouvellement_air\":\"12.344051915699026\",\"deperdition_mur\":\"3.6591848627932442\",\"deperdition_plancher_bas\":\"4.5749001614\",\"deperdition_plancher_haut\":\"0\",\"deperdition_baie_vitree\":\"2.268\",\"deperdition_porte\":\"0.93450000000000011\",\"deperdition_pont_thermique\":\"0\",\"deperdition_enveloppe\":\"23.780636939892268\"},\"apport_et_besoin\":{\"surface_sud_equivalente\":\"8.6184\",\"apport_solaire_fr\":\"0\",\"apport_interne_fr\":\"0\",\"apport_solaire_ch\":\"349.612578\",\"apport_interne_ch\":\"757.44136348571442\",\"fraction_apport_gratuit_ch\":\"0.49079915274182145\",\"fraction_apport_gratuit_depensier_ch\":\"0.45041477739534497\",\"pertes_distribution_ecs_recup\":\"22.774515599621129\",\"pertes_distribution_ecs_recup_depensier\":\"32.916011215851888\",\"pertes_stockage_ecs_recup\":\"163.61051178082192\",\"pertes_generateur_ch_recup\":\"0\",\"pertes_generateur_ch_recup_depensier\":\"0\",\"nadeq\":\"1.0961875\",\"v40_ecs_journalier\":\"61.386500000000005\",\"v40_ecs_journalier_depensier\":\"86.598812500000008\",\"besoin_ch\":\"547.2600496963521\",\"besoin_ch_depensier\":\"744.803921525226\",\"besoin_ecs\":\"717.6017087242501\",\"besoin_ecs_depensier\":\"1012.3309819502815\",\"besoin_fr\":\"0\",\"besoin_fr_depensier\":\"0\"},\"ef_conso\":{\"conso_ch\":\"521.89298781240382\",\"conso_ch_depensier\":\"710.28013858287375\",\"conso_ecs\":\"1287.1347405637102\",\"conso_ecs_depensier\":\"1604.0479375809478\",\"conso_eclairage\":\"28.5957\",\"conso_auxiliaire_generation_ch\":\"0\",\"conso_auxiliaire_generation_ch_depensier\":\"0\",\"conso_auxiliaire_distribution_ch\":\"0\",\"conso_auxiliaire_generation_ecs\":\"0\",\"conso_auxiliaire_generation_ecs_depensier\":\"0\",\"conso_auxiliaire_distribution_ecs\":\"0\",\"conso_auxiliaire_ventilation\":\"0\",\"conso_totale_auxiliaire\":\"0\",\"conso_fr\":\"0\",\"conso_fr_depensier\":\"0\",\"conso_5_usages\":\"1837.6234283761141\",\"conso_5_usages_m2\":\"121\"},\"ep_conso\":{\"ep_conso_ch\":\"1200.3538719685289\",\"ep_conso_ch_depensier\":\"1200.3538719685289\",\"ep_conso_ecs\":\"2960.4099032965332\",\"ep_conso_ecs_depensier\":\"2960.4099032965332\",\"ep_conso_eclairage\":\"65.77011\",\"ep_conso_auxiliaire_generation_ch\":\"0\",\"ep_conso_auxiliaire_generation_ch_depensier\":\"0\",\"ep_conso_auxiliaire_distribution_ch\":\"0\",\"ep_conso_auxiliaire_generation_ecs\":\"0\",\"ep_conso_auxiliaire_generation_ecs_depensier\":\"0\",\"ep_conso_auxiliaire_distribution_ecs\":\"0\",\"ep_conso_auxiliaire_ventilation\":\"0\",\"ep_conso_totale_auxiliaire\":\"0\",\"ep_conso_fr\":\"0\",\"ep_conso_fr_depensier\":\"0\",\"ep_conso_5_usages\":\"4226.533885265063\",\"ep_conso_5_usages_m2\":\"279\",\"classe_bilan_dpe\":\"D\"},\"emission_ges\":{\"emission_ges_ch\":\"41.2295460371799\",\"emission_ges_ch_depensier\":\"41.2295460371799\",\"emission_ges_ecs\":\"83.663758136641164\",\"emission_ges_ecs_depensier\":\"83.663758136641164\",\"emission_ges_eclairage\":\"1.9731033000000002\",\"emission_ges_auxiliaire_generation_ch\":\"0\",\"emission_ges_auxiliaire_generation_ch_depensier\":\"0\",\"emission_ges_auxiliaire_distribution_ch\":\"0\",\"emission_ges_auxiliaire_generation_ecs\":\"0\",\"emission_ges_auxiliaire_generation_ecs_depensier\":\"0\",\"emission_ges_auxiliaire_distribution_ecs\":\"0\",\"emission_ges_auxiliaire_ventilation\":\"0\",\"emission_ges_totale_auxiliaire\":\"0\",\"emission_ges_fr\":\"0\",\"emission_ges_fr_depensier\":\"0\",\"emission_ges_5_usages\":\"126.86640747382107\",\"emission_ges_5_usages_m2\":\"8\",\"classe_emission_ges\":\"B\"},\"cout\":{\"cout_ch\":\"115.72611099057978\",\"cout_ch_depensier\":\"115.72611099057978\",\"cout_ecs\":\"285.41310445782318\",\"cout_ecs_depensier\":\"285.41310445782318\",\"cout_eclairage\":\"6.3408959869812431\",\"cout_auxiliaire_generation_ch\":\"0\",\"cout_auxiliaire_generation_ch_depensier\":\"0\",\"cout_auxiliaire_distribution_ch\":\"0\",\"cout_auxiliaire_generation_ecs\":\"0\",\"cout_auxiliaire_generation_ecs_depensier\":\"0\",\"cout_auxiliaire_distribution_ecs\":\"0\",\"cout_auxiliaire_ventilation\":\"0\",\"cout_total_auxiliaire\":\"0\",\"cout_fr\":\"0\",\"cout_fr_depensier\":\"0\",\"cout_5_usages\":\"407.48011143538423\"},\"production_electricite\":{\"production_pv\":\"0\",\"conso_elec_ac\":\"0\",\"conso_elec_ac_ch\":\"0\",\"conso_elec_ac_ecs\":\"0\",\"conso_elec_ac_fr\":\"0\",\"conso_elec_ac_eclairage\":\"0\",\"conso_elec_ac_auxiliaire\":\"0\",\"conso_elec_ac_autre_usage\":\"0\"},\"sortie_par_energie_collection\":{\"sortie_par_energie\":{\"enum_type_energie_id\":\"1\",\"conso_ch\":\"521.89298781240382\",\"conso_ecs\":\"1287.1347405637102\",\"conso_5_usages\":\"1837.6234283761141\",\"emission_ges_ch\":\"41.2295460371799\",\"emission_ges_ecs\":\"83.663758136641164\",\"emission_ges_5_usages\":\"126.86640747382107\",\"cout_ch\":\"115.72611099057978\",\"cout_ecs\":\"285.41310445782318\",\"cout_5_usages\":\"407.48011143538423\"}},\"confort_ete\":{\"isolation_toiture\":\"0\",\"protection_solaire_exterieure\":\"1\",\"aspect_traversant\":\"0\",\"brasseur_air\":\"0\",\"inertie_lourde\":\"0\",\"enum_indicateur_confort_ete_id\":\"2\"},\"qualite_isolation\":{\"ubat\":\"0.29174961796411336\",\"qualite_isol_enveloppe\":\"1\",\"qualite_isol_mur\":\"2\",\"qualite_isol_plancher_haut_comble_perdu\":\"1\",\"qualite_isol_plancher_bas\":\"4\",\"qualite_isol_menuiserie\":\"3\"}}},\"descriptif_enr_collection\":null,\"descriptif_simplifie_collection\":{\"descriptif_simplifie\":{\"description\":\"Ballon électrique à accumulation vertical (autres catégorie ou inconnue), contenance ballon 100 L\",\"enum_categorie_descriptif_simplifie_id\":\"6\"}},\"fiche_technique_collection\":{\"fiche_technique\":{\"enum_categorie_fiche_technique_id\":\"8\",\"sous_fiche_technique_collection\":{\"sous_fiche_technique\":{\"description\":\"Volume de stockage: 100 L\",\"valeur\":\"100 L\",\"detail_origine_donnee\":null,\"enum_origine_donnee_id\":\"2\"}}}},\"justificatif_collection\":{\"justificatif\":{\"description\":\"Notices techniques des équipements\",\"enum_type_justificatif_id\":\"10\"}},\"descriptif_geste_entretien_collection\":{\"descriptif_geste_entretien\":{\"description\":\"Veiller à ouvrir les fenêtres de chaque pièce très régulièrement\",\"enum_picto_geste_entretien_id\":\"1\",\"categorie_geste_entretien\":\"Ventilation\"}},\"descriptif_travaux\":{\"pack_travaux_collection\":{\"pack_travaux\":{\"enum_num_pack_travaux_id\":\"1\",\"conso_5_usages_apres_travaux\":\"269\",\"emission_ges_5_usages_apres_travaux\":\"8\",\"cout_pack_travaux_min\":\"100\",\"cout_pack_travaux_max\":\"150\",\"travaux_collection\":{\"travaux\":{\"description_travaux\":\"Isolation des murs par l'intérieur.\\nAvant d'isoler un mur, vérifier qu'il ne présente aucune trace d'humidité.\",\"enum_lot_travaux_id\":\"1\",\"avertissement_travaux\":null,\"performance_recommande\":\"R > 4,5 m².K/W\"}}}},\"commentaire_travaux\":null}}}";
        HttpResponse<String> predictedResponse = new TestHttpResponse(200, expectedResponseBody);

        doReturn(predictedResponse).when(client).send(Mockito.any(), Mockito.any());

        AdemeResultModel result = ademeApiService.getDpeDetails("1234567890");

        // Add assertions to verify the content of the result
        assertThat(result).isNotNull();
    }

}

