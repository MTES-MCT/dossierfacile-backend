<!DOCTYPE html>
<html lang="en"
      layout:decorator="bo/layout-bo"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>DossierFacile</title>
</head>
<body>
<div layout:fragment="content" th:remove="tag">

    <div class="row class-message-link">
        <div class="col-md-12 col-lg-12">

            <ul class="nav nav-tabs" role="tablist">

                <li class="active" role="presentation">
                    <a aria-controls="colocatio" data-toggle="tab" href="#colocatio"
                       role="presentation"
                       th:text="#{apartmentSharing}"></a></li>

                <li role="presentation" th:each="tenant,iter:${tenants}">
                    <a aria-controls="mon-dossier" class="data-tab2" data-toggle="tab" role="tab"
                       th:attr="data-name=${tenant.id}"
                       th:href="'#tenant'+${tenant.id}" th:id="'badge2' + ${tenant.id}"
                       th:text="${tenant.getFullName()} ==''? 'locataire ':${tenant.getFullName()}"></a></li>

                <li role="presentation" th:each="tenant,iter:${tenants}">
                    <a aria-controls="mon-dossier" class="chat"
                       data-toggle="tab" role="tab" th:attr="data-name=${tenant},data-nameAdmin=${name}"
                       th:attrappend="data-id=${tenant.id}"
                       th:href="'#tenant-message'+${tenant.id}" th:text="'message: '+${tenant.getFullName()}"></a>
                </li>

            </ul>
            <!-- Tab panes -->

            <div class="tab-content">
                <div class="tab-pane active" id="colocatio" role="tabpanel">

                    <div class="container">
                        <div class="medium-space-separator">
                            <div clas="row">
                                <div class="">
                                    <button class="btn btn-success bo-btn deleteApartmentSharing"
                                            style="color: white;background-color: #f0ad4e;float: right;margin-right: 10px;margin-bottom: 10px;background-color: #d9534f;border-color: #d43f3a;"
                                            th:href="@{/bo/tenant/deleteApartmentSharing/} + ${tenantPrincipal.getId()}"
                                    >Supprimer la colocation
                                    </button>
                                    <a class="btn btn-success bo-btn btnPartner"
                                       style="float: left;background-color: darkcyan;border-color: aliceblue;">
                                        Trigger a partner callback
                                    </a>
                                </div>

                            </div>
                            <div class="modal" id="triggerPart" role="dialog"
                                 tabindex="-1">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header" style="background: #f18686;padding: 10px;">
                                            <h5 class="modal-title bold"
                                                style="width: 80%;float: left;font-size: 20px;">Select</h5>
                                            <button aria-label="Close" class="close" data-dismiss="modal"
                                                    type="button">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body"
                                             style="background: aliceblue;text-shadow: 0 0 black;">
                                            <form method="get"
                                                  style="margin-top: 8px;"
                                                  th:action="@{/bo/tenant/partner/}+${tenantPrincipal.getId()}"
                                                  th:object="${partnerUpdate}">
                                                <label for="action2" style="margin-left: 5px">partner:</label>
                                                <select id="action2" name="action"
                                                        style=" border-radius: 3px; padding-left: 5px !important;padding-right: 5px; width: 26%"
                                                        th:field="*{partner}">
                                                    <option selected="selected" value="">-----------------</option>
                                                    <option th:each="partner:${partnersList}"
                                                            th:text="${partner.getName()}"
                                                            th:value="${partner.getId()}"></option>
                                                </select>

                                                <label class="active"
                                                       style="margin-left: 5px;">internalPartnerId:</label>
                                                <input class="inputPartner"
                                                       style="width: 23%;border: 1px solid #c6d6f3 !important;height: auto;border-radius: 3px;padding-left: 5px !important;padding-right: 5px;"
                                                       th:field="*{internalPartnerId}"
                                                       th:placeholder="'-- type here --'"
                                                       type="text">

                                                <div class="modal-footer"
                                                     style="background: aliceblue;padding: 5px;margin-top: 20px;">
                                                    <button class="btn btn-primary buttonPartner"
                                                            id="hrefPartner" name="submit"
                                                            style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                            type="submit"
                                                            value="submit">
                                                        Submit
                                                    </button>
                                                    <button class="btn btn-secondary" data-dismiss="modal"
                                                            style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                            type="button">
                                                        Cancel
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                        <script>
                                            let input = document.querySelector(".inputPartner");
                                            let button = document.querySelector(".buttonPartner");

                                            button.disabled = true;

                                            input.addEventListener("change", stateHandle);

                                            function stateHandle() {
                                                if (document.querySelector(".inputPartner").value === "-- type here --") {
                                                    button.disabled = true;
                                                } else {
                                                    button.disabled = false;
                                                }
                                            }
                                        </script>

                                    </div>
                                </div>
                            </div>
                            <div class="modal" id="deleteTenant" role="dialog"
                                 tabindex="-1">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header" style="background: #f18686;padding: 10px;">
                                            <h5 class="modal-title bold" style="width: 80%;float: left;">Confirm
                                                delete</h5>
                                            <button aria-label="Close" class="close" data-dismiss="modal"
                                                    type="button">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body"
                                             style="background: aliceblue;text-shadow: 0 0 black;">
                                            <p>Are you sure you want delete this tenant ?</p>
                                        </div>
                                        <div class="modal-footer" style="background: aliceblue;padding: 5px;">
                                            <a class="btn btn-primary"
                                               id="idRef"
                                               style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                               th:href="@{/bo/tenant/delete/tenant/} + ${tenantPrincipal.getId()}">Delete</a>
                                            <button class="btn btn-secondary" data-dismiss="modal"
                                                    style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                    type="button">
                                                Close
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal" id="deleteApartmentSharing" role="dialog"
                                 tabindex="-1">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header" style="background: #f18686;padding: 10px;">
                                            <h5 class="modal-title bold" style="width: 80%;float: left;">
                                                Confirmation
                                            </h5>
                                            <button aria-label="Close" class="close" data-dismiss="modal"
                                                    type="button">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body"
                                             style="background: aliceblue;text-shadow: 0 0 black;">
                                            <p>Êtes-vous sûr de vouloir supprimer ce dossier ainsi que tous ses candidats ?</p>
                                        </div>
                                        <div class="modal-footer" style="background: aliceblue;padding: 5px;">
                                            <a class="btn btn-primary"
                                               id="idRefApt"
                                               style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                               th:href="@{/bo/tenant/deleteApartmentSharing/} + ${tenantPrincipal.getId()}">
                                                Oui
                                            </a>
                                            <button class="btn btn-secondary" data-dismiss="modal"
                                                    style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                    type="button">
                                                Annuler
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <table class="table table-striped table-bordered table-hover">
                                <tr>
                                    <td>Status</td>
                                    <td colspan="2" th:text="${apartmentSharing.getStatus()}"></td>
                                </tr>
                                <tr>
                                    <td>Tenants</td>
                                    <td colspan="2" th:text="${apartmentSharing.getNumberOfTenants()}"></td>
                                </tr>
                                <tr>
                                    <td>Complete register</td>
                                    <td colspan="2" th:text="${apartmentSharing.getNumberOfCompleteRegister()}"></td>
                                </tr>
                                <tr class="${apartmentSharing.getStatus().name() != 'VALIDATED'}">
                                    <td colspan="3">The application links will be available when the application is
                                        validated
                                    </td>
                                </tr>
                                <tr th:if="${apartmentSharing.getStatus().name()} == 'VALIDATED'">
                                    <td>Link restricted</td>
                                    <td th:text="${@environment.getProperty('link.domain.document')+'/public-file/' + apartmentSharing.getTokenPublic()}"></td>
                                    <td rowspan="2">
                                        <form th:action="@{/bo/colocation/{id}/tokens/(id=${apartmentSharing.id})}" th:method="delete">
                                            <button class="btn-delete btn-modal-confirm-before-submit" type="button">
                                                <span style="color:red">Regénérer</span>
                                            </button>
                                            <div class="modal" role="dialog" tabindex="-1">
                                                <div class="modal-dialog" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-body">
                                                            <div class="modal-body">
                                                                Voulez-vous regénérer les tokens ?
                                                            </div>

                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
                                                                <button class="btn  btn-primary " type="submit">Valider</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </td>
                                </tr>
                                <tr th:if="${apartmentSharing.getStatus().name()} == 'VALIDATED'">
                                    <td>Link full</td>
                                    <td th:text="${@environment.getProperty('link.domain.document')+'/file/' + apartmentSharing.getToken()}"></td>
                                </tr>

                            </table>
                            <h2>Liste des liens envoyés:</h2>
                            <table class="table table-striped table-bordered table-hover">
                                <tr>
                                    <th>Type</th>
                                    <th>Email</th>
                                    <th>Token</th>
                                    <th>Action</th>
                                </tr>
                                <tr th:each="link : ${apartmentSharing.apartmentSharingLinks}">
                                    <td th:text="${link.linkType}"></td>
                                    <td th:text="${link.email}"></td>
                                    <td th:text="${link.token}"></td>
                                    <td>
                                        <form th:action="@{/bo/colocation/{id}/apartmentSharingLinks/{link_id}(id=${apartmentSharing.id},link_id=${link.id})}" th:method="delete">
                                            <button class="btn-delete btn-modal-confirm-before-submit" type="button">
                                                <span style="color:red">Supprimer</span>
                                            </button>
                                            <div class="modal" role="dialog" tabindex="-1">
                                                <div class="modal-dialog" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-body">
                                                            <div class="modal-body">
                                                                Voulez-vous supprimer le lien?
                                                            </div>

                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
                                                                <button class="btn  btn-primary " type="submit">Valider</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="tab-pane data-tab2" role="tabpanel"
                     th:each="tenant,iter: ${tenants}" th:id="'tenant'+${tenant.id}">

                    <div class="container">
                        <div class="medium-space-separator">
                            <div class="row">
                                <div class="col-md-5">
                                    <form
                                            class="form-inline btn-validate-form"
                                            style="float: left; margin-right: 10px;"
                                            th:action="@{/bo/tenant/} + ${tenant.getId()} + '/validate'"
                                            th:attr="data-id=${tenant.getId()},data-idApt=${tenant.getApartmentSharing().getId()}"
                                            th:id="'form-validated' + ${tenant.getId()}"
                                            th:method="post">
                                        <button class="btn btn-success bo-btn" name="action" type="submit"
                                                value="delete">
                                            Valider le dossier
                                        </button>
                                    </form>
                                    <form
                                            class="form-inline btn-denied-form"
                                            style="float: left; margin-right: 10px;"
                                            th:action="@{/bo/tenant/} + ${tenant.getId()} + '/decline'"
                                            th:attr="data-id=${tenant.getId()},data-idApt=${tenant.getApartmentSharing().getId()}"
                                            th:id="'form-denied' + ${tenant.getId()}"
                                            th:method="post">
                                        <button class="btn btn-danger bo-btn" name="action" type="submit">
                                            Refuser le dossier
                                        </button>
                                    </form>
                                    <a class="btn btn-success bo-btn" data-toggle="modal"
                                       style="background-color: darkcyan;" th:data-target="'#target'+${tenant.getId()}">Logs</a>
                                </div>
                                <div class="col-md-7">

                                    <a class="btn btn-success bo-btn"
                                       style="float: right;"
                                       th:href="@{/bo/tenant/} + ${tenant.getId()} + '/processFile'">
                                        Traiter les documents
                                    </a>
                                    <div th:if="${ tenant.getTenantType().toString() == 'JOIN' }">
                                        <a class="btn btn-warning bo-btn"
                                           style="margin-right: 10px;float: right"
                                           th:attrappend="data-id=${tenant.getId()}"
                                           th:href="@{/bo/tenant/setAsTenantCreate/} + ${tenant.getId()}"
                                           th:text="'Fixer comme locataire principal'"
                                        ></a>
                                    </div>
                                    <div th:if="${ tenant.getTenantType().toString() != 'CREATE'}">
                                        <a class="btn btn-danger bo-btn btn-deleteCotenant"
                                           style="margin-right: 10px;float: right"
                                           th:attrappend="data-id=${tenant.getId()}"
                                           th:href="@{/bo/tenant/deleteCoTenant/} + ${tenant.getId()}"
                                           th:text="'Supprimer le colocataire'"
                                        ></a>
                                    </div>
                                </div>

                                <div aria-hidden="true" aria-labelledby="exampleModalScrollableTitle" class="modal fade"
                                     role="dialog"
                                     tabindex="-1" th:id="'target'+${tenant.getId()}">
                                    <div class="modal-dialog modal-dialog-scrollable" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header" style="background: cadetblue;">
                                                <h3 class="modal-title" id="exampleModalScrollableTitle"
                                                    style="text-align: -webkit-center;"
                                                    th:text="'Logs: ' + ${tenant.getFullName()}"></h3>
                                                </button>
                                            </div>
                                            <div class="modal-body"
                                                 style="max-height: 80vh;overflow-y: auto; background: aliceblue;height: auto">
                                                <div style="background: antiquewhite; display: grid; padding: 7px;margin-bottom: 10px;"
                                                     th:each="log: ${logser.getLogByTenantId(tenant.getId())}">
                                                    <p style="font-weight: bold;" th:text="${log.getLogType()} + ${ (log.getOperatorId() != null)? ' by opId: ' + log.getOperatorId() : ''}">
                                                    </p>
                                                    <span style="padding-left: 5px;"
                                                          th:text="'date: ' + ${log.getCreationDateTime().getYear()} + '-' + ${log.getCreationDateTime().getMonthValue()} + '-' + ${log.getCreationDateTime().getDayOfMonth()} + ' ' + ${log.getCreationDateTime().getHour()} + ':' + ${log.getCreationDateTime().getMinute()} + ':' + ${log.getCreationDateTime().getSecond()}">
                                                       </span>
                                                </div>
                                            </div>
                                            <div class="modal-footer" style="background: aliceblue;">
                                                <button class="btn btn-secondary" data-dismiss="modal"
                                                        style="font-size: initial;color: white;background-color: #0069d9;"
                                                        type="button">
                                                    Close
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="modal" role="dialog" tabindex="-1"
                                     th:id="'deleteCotenant'+${tenant.getId()}">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header" style="background: lavender;padding: 10px;">
                                                <h5 class="modal-title bold" style="width: 80%;float: left;">
                                                    Confirmation
                                                </h5>
                                                <button aria-label="Close" class="close" data-dismiss="modal"
                                                        type="button">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body"
                                                 style="background: aliceblue;text-shadow: 0 0 black;">
                                                <p>
                                                    Êtes-vous sûr de vouloir supprimer le dossier de
                                                    <span th:text="${tenant.getFullName()}"></span> ?
                                                </p>
                                            </div>
                                            <div class="modal-footer" style="background: aliceblue;padding: 5px;">
                                                <a class="btn btn-primary"
                                                   style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                   th:href="@{/bo/tenant/deleteCoTenant/} + ${tenant.getId()}"
                                                   th:id="'deleteRefCo' + ${tenant.getId()}">
                                                    Oui
                                                </a>
                                                <button class="btn btn-secondary" data-dismiss="modal"
                                                        style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                        type="button">
                                                    Annuler
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                            </div>
                        </div>
                        <div class="row" style="margin-bottom: 8px;">
                            <div class="col-md-12"
                                 th:style="${partnerListByTenant.getNamesOfPartnerByTenantId(tenant.getId()).isEmpty()}?'display:none':'margin-bottom: 8px;'">
                                <div class="col-md-1">
                                    <h4 style="margin-left: -15px;">Partner(s)</h4>
                                </div>
                                <div class=" col-md-11">
                                    <div class="scrollmenu"
                                         style="background-color: #333;overflow: auto;white-space: nowrap;margin-right: -12px">
                                        <a href="#"
                                           style="display: inline-block;color: white;text-align: center;padding: 14px;text-decoration: none;"
                                           th:each="item : ${partnerListByTenant.getNamesOfPartnerByTenantId(tenant.getId())}"
                                           th:text="${item}"></a>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="table-responsive">

                            <table class="table table-striped table-bordered table-hover">
                                <tr>
                                    <td>Tenant Id</td>
                                    <td th:text="${tenant.getId()}"></td>
                                </tr>
                                <tr>
                                    <td>Prénom</td>
                                    <td th:text="${tenant.getFirstName()}"></td>
                                </tr>
                                <tr>
                                    <td>Nom</td>
                                    <td th:text="${tenant.getLastName()}"></td>
                                </tr>
                                <tr>
                                    <td>Nom d'usage</td>
                                    <td th:text="${tenant.getPreferredName()}"></td>
                                </tr>
                                <tr>
                                    <td>Email</td>
                                    <td>
                                        <span th:if="${ tenant.getFranceConnect() == true }"><img src="/assets/images/franceconnect-icon.png" height="22px" alt="isFC"/></span>
                                        <span th:text="${tenant.getEmail()}"></span>
                                        <span th:with="verified=${tenantService.hasVerifiedEmailIfExistsInKeycloak(tenant)}">
                                            <span class="fa"
                                                  th:if="${verified != null}"
                                                  th:classappend="${verified} ? 'fa-check text-success' : 'fa-times text-danger'"
                                                  th:text="${verified} ? ' Vérifié' : ' Non vérifié'">
                                            </span>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Code postal</td>
                                    <td th:text="${tenant.getZipCode()}"></td>
                                </tr>
                                <tr>
                                    <td>Type de compte</td>
                                    <td th:text="${tenant.getTenantType().toString() == 'CREATE' ?
                                        'Utilisateur principal (initiateur du dossier)' :
                                        'Utilisateur invité (pas initiateur du dossier)'}">
                                    </td>
                                </tr>
                                <tr>
                                    <td>Statut du dossier</td>
                                    <td th:text="${tenant.getStatus()}"></td>
                                </tr>
                            </table>
                        </div>

                        <div class="table-responsive" th:unless="${tenant.getGuarantors().isEmpty()}">

                            <table class="table table-striped table-bordered table-hover">
                                <tr>
                                    <td>Type de garant</td>
                                    <td>Prénom</td>
                                    <td>Nom</td>
                                    <td>Nom de la personne morale</td>
                                </tr>
                                <tr th:each="guarantor : ${tenant.getGuarantors()}">
                                    <td th:text="${guarantor.getTypeGuarantor()}"></td>
                                    <td th:text="${guarantor.getFirstName()}"></td>
                                    <td th:text="${guarantor.getLastName()}"></td>
                                    <td th:text="${guarantor.getLegalPersonName()}"></td>
                                </tr>
                            </table>
                        </div>

                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover">
                                <tr>
                                    <td style="width: 20%">Déclaration sur l'honneur</td>
                                    <td th:text="${tenant.getHonorDeclaration()}"></td>
                                </tr>
                                <tr>
                                    <td>Mot du locataire</td>
                                    <td th:text="${tenant.getClarification()}"></td>
                                </tr>
                            </table>
                        </div>

                        <div class="medium-space-separator" id="update-status">
                            <div class="panel panel-primary"
                                 th:each="document : ${tenantService.getAllDocumentCategories(tenant)}">

                                <div class="panel-heading">

                                    <h4 class="panel-title" th:if="${document.getId() == null}">
                                        <span>Category:
                                            <span style="color:black"
                                                  th:text="${document.getDocumentCategory().name()}">
                                            </span>
                                        </span>
                                    </h4>

                                    <h4 class="panel-title"
                                        th:if="${document.getId() != null} and ${document.getWatermarkFile() == null}">
                                        <span>Category:
                                            <span style="color:black"
                                                  th:text="${document.getDocumentCategory().name()}">
                                            </span>
                                        </span>
                                        <span> Subcategory:
                                            <span style="color:black"
                                                  th:text="${document.getDocumentSubCategory().name()}">
                                            </span>
                                        </span>

                                        <a class="btn-danger btn-right-pull label pull-right deleteButton"
                                           style="margin-right: -5px;color: black;background-color: #f0ad4e"
                                           th:attrappend="data-id=${document.id}"

                                           th:href="@{/bo/tenant/delete/document/} + ${document.getId()}"
                                        >DELETE
                                        </a>

                                        <span class="btn-right-pull label label-success pull-right"
                                              style="color: black;"
                                              th:if="${document.getDocumentStatus().name()=='VALIDATED'}"
                                              th:text="${document.getDocumentStatus()}">
                                        </span>
                                        <span class="btn-right-pull label label-danger pull-right" style="color: black;"
                                              th:if="${document.getDocumentStatus().name()=='DECLINED'}"
                                              th:text="${document.getDocumentStatus()}">
                                        </span>
                                        <span class="btn-right-pull label label-info pull-right" style="color: black;"
                                              th:if="${document.getDocumentStatus().name()=='TO_PROCESS'}"
                                              th:text="${document.getDocumentStatus()}">
                                        </span>

                                        <div class="container" style="margin-top: 5px; padding-left: 0">
                                            <span style="color:orange; font-weight: bolder"
                                                  th:if="${document.getProcessingStartTime() == null}">
                                                    Pdf should be updated
                                                <button th:class="'btn-regenerate-pdf'">
                                                    <a th:href="@{/bo/regeneratePdfDocument/} + ${document.getId()}">Update Document PDF</a>
                                                </button>
                                            </span>
                                            <span style="color:orange; font-weight: bolder"
                                                  th:if="${document.getProcessingStartTime() != null} and ${document.getProcessingEndTime() != null}">
                                                    Pdf should be updated
                                                <button th:class="'btn-regenerate-pdf'">
                                                    <a th:href="@{/bo/regeneratePdfDocument/} + ${document.getId()}">Update Document PDF</a>
                                                </button>
                                            </span>
                                            <span th:if="${document.getProcessingStartTime() != null} and ${document.getProcessingEndTime() == null}">
                                                PDF status:
                                                <span th:if="${document.getProcessingStartTime().plusHours(1).isBefore(now)}">
                                                    <span style="color:white; background-color: red; font-weight: bolder">
                                                        FAILED
                                                    </span>
                                                    <button th:class="'btn-regenerate-pdf'">
                                                        <a th:href="@{/bo/regeneratePdfDocument/} + ${document.getId()}">Update Document PDF</a>
                                                    </button>
                                                </span>
                                                <span style="color:white; background-color: limegreen; font-weight: bolder"
                                                      th:if="${document.getProcessingStartTime().plusHours(1).isAfter(now)}">
                                                    IN PROGRESS
                                                    <button th:class="'btn-regenerate-pdf'">
                                                        <a th:href="@{/bo/regeneratePdfDocument/} + ${document.getId()}">Force update PDF</a>
                                                    </button>
                                                </span>
                                            </span>
                                        </div>
                                    </h4>

                                    <h4 class="panel-title"
                                        th:if="${document.getId() != null} and ${document.getWatermarkFile() != null}">
                                        <span>Category:
                                            <span
                                                    th:text="${document.getDocumentCategory().name()}">
                                            </span>
                                        </span>
                                        <span> Subcategory:
                                            <span
                                                    th:text="${document.getDocumentSubCategory().name()}">
                                            </span>
                                        </span>

                                        <a class="btn-danger btn-right-pull label pull-right deleteButton"
                                           style="margin-right: -5px;color: black;background-color: #f0ad4e"
                                           th:attrappend="data-id=${document.id}"

                                           th:href="@{/bo/tenant/delete/document/} + ${document.getId()}"
                                        >DELETE
                                        </a>

                                        <span class="btn-right-pull label label-success pull-right"
                                              style="color: black;"
                                              th:if="${document.getDocumentStatus().name()=='VALIDATED'}"
                                              th:text="${document.getDocumentStatus()}">
                                        </span>
                                        <span class="btn-right-pull label label-danger pull-right" style="color: black;"
                                              th:if="${document.getDocumentStatus().name()=='DECLINED'}"
                                              th:text="${document.getDocumentStatus()}">
                                        </span>
                                        <span class="btn-right-pull label label-info pull-right" style="color: black;"
                                              th:if="${document.getDocumentStatus().name()=='TO_PROCESS'}"
                                              th:text="${document.getDocumentStatus()}">
                                        </span>

                                        <div class="container" style="display: flex; margin-top: 5px">
                                            <form method="get" style="margin-top: 8px;"
                                                  th:action="@{/bo/tenant/status/} + ${document.getId()}"
                                                  th:id="'form-change-document-status' + ${document.getId()}"
                                                  th:object="${messageDTO}">
                                                <label for="action"
                                                       style="FONT-SIZE:revert;color: white;">Change status:</label>
                                                <select id="action" name="action"
                                                        style="color: black;font-size: smaller;"
                                                        th:attr="document-id=${document.getId()}"
                                                        th:class="'select-change-document-status'"
                                                        th:field="*{message}">
                                                    <option value="">-- SELECT --</option>
                                                    <option th:value="DECLINED">DECLINED</option>
                                                    <option th:value="TO_PROCESS">TO_PROCESS</option>
                                                    <option th:value="VALIDATED">VALIDATED</option>
                                                </select>
                                            </form>

                                            <button th:class="'btn-regenerate-pdf'">
                                                <a th:href="@{/bo/regeneratePdfDocument/} + ${document.getId()}">Update
                                                    Document PDF</a>
                                            </button>

                                            <a style="font-size: smaller;margin-top: 9px;border-radius: .15em; margin-left: 2%; margin-bottom: auto;background: #efefef;padding: 1.5px;border-width: 2px;"
                                               th:href="${'/documents/'+ document.getName()}" target="_blank">See Document PDF</a>
                                        </div>
                                    </h4>

                                </div>

                                <div class="panel-body" style="text-align: -webkit-center;background: #f0be4e"
                                     th:if="${document.getId() == null}">
                                    <h4 style="font-weight: bold;">ABSENT</h4>
                                </div>

                                <div class="panel-body" th:if="${document.getId() != null}">
                                    <div th:if="${document.getMonthlySum()!=null}">
                                        <span th:text="${'Montly sum: '+document.getMonthlySum()}"></span>
                                    </div>
                                    <div th:if="${document.getCustomText()!=null}">
                                        <span th:text="${'Custom text: '+document.getCustomText()}"></span>
                                    </div>

                                    <ul>
                                        <li style="margin-top: 5px" th:each="file : ${filesByDocument.get(document.getId())}">
                                            <a th:href="${'/files/' + file.getId()}"
                                               th:text="${file.summary}"></a>
                                            <span th:if="${file.hasBeenAnalyzed()}" th:with="analysis=${file.analysis}">
                                                <span class="fa" th:classappend="${analysis.authenticationStatusCssClass}"
                                                      th:text="' ' + ${analysis.authenticationStatus}"></span>
                                                <span class="fa fa-times text-danger" th:if="${analysis.isInWrongCategory}"
                                                > Mauvaise catégorie</span>
                                                <br/>
                                                <span class="small" th:if="${analysis.isNotAuthenticated}">
                                                    <span class="bold">Devrait contenir : </span>
                                                    <span th:text="${analysis.authenticatedContent}"></span>
                                                </span>
                                            </span>
                                        </li>
                                    </ul>
                                    <div th:if="${document.avisDetected}">
                                        - Attention, un avis de situation a été détecté !
                                    </div>
                                </div>
                                <div class="modal" role="dialog" tabindex="-1"
                                     th:id="'deleteModal'+${document.getId()}">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header" style="background: lavender;padding: 10px;">
                                                <h5 class="modal-title bold" style="width: 80%;float: left;">
                                                    Confirmation
                                                </h5>
                                                <button aria-label="Close" class="close" data-dismiss="modal"
                                                        type="button">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body"
                                                 style="background: aliceblue;text-shadow: 0 0 black;">
                                                <p>Êtes-vous sûr de vouloir supprimer ce document ?</p>
                                            </div>
                                            <div class="modal-footer" style="background: aliceblue;padding: 5px;">
                                                <a class="btn btn-primary"
                                                   style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                   th:href="@{/bo/tenant/delete/document/} + ${document.getId()}"
                                                   th:id="'deleteRef' + ${document.getId()}">
                                                    Oui
                                                </a>
                                                <button class="btn btn-secondary" data-dismiss="modal"
                                                        style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                        type="button">
                                                    Annuler
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h3 th:unless="${tenant.getGuarantors().isEmpty()}">Garants</h3>
                        <div class="medium-space-separator" th:each="guarantor : ${tenant.getGuarantors()}">
                            <span style="display: ruby-text;">
                                <h4 th:text="${guarantor.getTypeGuarantor()}"></h4>
                                <a class="btn btn-danger bo-btn btn-deleteGuarantor"
                                   style="margin-right: 10px; margin-left: 20px; margin-top: -5px"
                                   th:attr="guarantor-id=${guarantor.getId()}"
                                   th:text="'Supprimer le garant'"
                                ></a>
                            </span>
                            <div class="panel panel-primary"
                                 th:each="document : ${tenantService.getAllDocumentCategoriesGuarantor(guarantor)}">
                                <div class="panel-heading">
                                    <h4 class="panel-title" th:if="${ document.getId() == null }">
                                        <span>Category:
                                            <span style="color:black"
                                                  th:text="${document.getDocumentCategory().name()}">
                                            </span>
                                        </span>
                                    </h4>

                                    <h4 class="panel-title"
                                        th:if="${document.getId() != null} and ${document.getWatermarkFile() == null}">
                                        <span>Category:
                                            <span style="color:black"
                                                  th:text="${document.getDocumentCategory().name()}">
                                            </span>
                                        </span>
                                        <span> Subcategory:
                                            <span style="color:black"
                                                  th:text="${document.getDocumentSubCategory().name()}">
                                            </span>
                                        </span>

                                        <a class="btn-danger btn-right-pull label pull-right deleteButton"
                                           style="margin-right: -5px;color: black;background-color: #f0ad4e"
                                           th:attrappend="data-id=${document.id}"

                                           th:href="@{/bo/tenant/delete/document/} + ${document.getId()}"
                                        >DELETE
                                        </a>

                                        <span class="btn-right-pull label label-success pull-right"
                                              style="color: black;"
                                              th:if="${document.getDocumentStatus().name()=='VALIDATED'}"
                                              th:text="${document.getDocumentStatus()}">
                                        </span>
                                        <span class="btn-right-pull label label-danger pull-right" style="color: black;"
                                              th:if="${document.getDocumentStatus().name()=='DECLINED'}"
                                              th:text="${document.getDocumentStatus()}">
                                        </span>
                                        <span class="btn-right-pull label label-info pull-right" style="color: black;"
                                              th:if="${document.getDocumentStatus().name()=='TO_PROCESS'}"
                                              th:text="${document.getDocumentStatus()}">
                                        </span>

                                        <div class="container" style="margin-top: 5px; padding-left: 0">
                                            <span style="color:orange; font-weight: bolder"
                                                  th:if="${document.getProcessingStartTime() == null}">
                                                    Pdf should be updated
                                                <button th:class="'btn-regenerate-pdf'">
                                                    <a th:href="@{/bo/regeneratePdfDocument/} + ${document.getId()}">Update Document PDF</a>
                                                </button>
                                            </span>
                                            <span style="color:orange; font-weight: bolder"
                                                  th:if="${document.getProcessingStartTime() != null} and ${document.getProcessingEndTime() != null}">
                                                    Pdf should be updated
                                                <button th:class="'btn-regenerate-pdf'">
                                                    <a th:href="@{/bo/regeneratePdfDocument/} + ${document.getId()}">Update Document PDF</a>
                                                </button>
                                            </span>
                                            <span th:if="${document.getProcessingStartTime() != null} and ${document.getProcessingEndTime() == null}">
                                                PDF status:
                                                <span th:if="${document.getProcessingStartTime().plusHours(1).isBefore(now)}">
                                                    <span style="color:white; background-color: red; font-weight: bolder">
                                                        FAILED
                                                    </span>
                                                    <button th:class="'btn-regenerate-pdf'">
                                                        <a th:href="@{/bo/regeneratePdfDocument/} + ${document.getId()}">Update Document PDF</a>
                                                    </button>
                                                </span>
                                                <span style="color:white; background-color: limegreen; font-weight: bolder"
                                                      th:if="${document.getProcessingStartTime().plusHours(1).isAfter(now)}">
                                                    IN PROGRESS
                                                    <button th:class="'btn-regenerate-pdf'">
                                                        <a th:href="@{/bo/regeneratePdfDocument/} + ${document.getId()}">Force update PDF</a>
                                                    </button>
                                                </span>
                                            </span>
                                        </div>
                                    </h4>

                                    <h4 class="panel-title"
                                        th:if="${ document.getId() != null} and ${document.getWatermarkFile() != null}">
                                        <span>Category:
                                            <span
                                                    th:text="${document.getDocumentCategory().name()}">
                                            </span>
                                        </span>
                                        <span> Subcategory:
                                            <span
                                                    th:text="${document.getDocumentSubCategory().name()}">
                                            </span>
                                        </span>

                                        <a class="btn-danger btn-right-pull label pull-right deleteButton"
                                           style="margin-right: -5px;color: black;background-color: #f0ad4e"
                                           th:attrappend="data-id=${document.id}"

                                           th:href="@{/bo/tenant/delete/document/} + ${document.getId()}"
                                        >DELETE
                                        </a>

                                        <span class="btn-right-pull label label-success pull-right"
                                              style="color: black;"
                                              th:if="${document.getDocumentStatus().name()=='VALIDATED'}"
                                              th:text="${document.getDocumentStatus()}">
                                        </span>
                                        <span class="btn-right-pull label label-danger pull-right" style="color: black;"
                                              th:if="${document.getDocumentStatus().name()=='DECLINED'}"
                                              th:text="${document.getDocumentStatus()}">
                                        </span>
                                        <span class="btn-right-pull label label-info pull-right" style="color: black;"
                                              th:if="${document.getDocumentStatus().name()=='TO_PROCESS'}"
                                              th:text="${document.getDocumentStatus()}">
                                        </span>

                                        <div class="container" style="display: flex; margin-top: 5px">
                                            <form method="get" style="margin-top: 8px;"
                                                  th:action="@{/bo/tenant/status/} + ${document.getId()}"
                                                  th:id="'form-change-document-status' + ${document.getId()}"
                                                  th:object="${messageDTO}">
                                                <label for="action1"
                                                       style="FONT-SIZE:revert;color: white;">Change status:</label>
                                                <select id="action1" name="action"
                                                        style="color: black;font-size: smaller;"
                                                        th:attr="document-id=${document.getId()}"
                                                        th:class="'select-change-document-status'"
                                                        th:field="*{message}">
                                                    <option value="">-- SELECT --</option>
                                                    <option th:value="DECLINED">DECLINED</option>
                                                    <option th:value="TO_PROCESS">TO_PROCESS</option>
                                                    <option th:value="VALIDATED">VALIDATED</option>
                                                </select>
                                            </form>

                                            <button th:class="'btn-regenerate-pdf'">
                                                <a th:href="@{/bo/regeneratePdfDocument/} + ${document.getId()}">Update
                                                    Document PDF</a>
                                            </button>

                                            <a style="font-size: smaller;margin-top: 9px;border-radius: .15em; margin-left: 2%; margin-bottom: auto;background: #efefef;padding: 1.5px;border-width: 2px;"
                                               th:href="${'/documents/'+ document.getName()}">See
                                                PDF Document</a>
                                        </div>
                                    </h4>

                                </div>
                                <div class="panel-body" style="text-align: -webkit-center;background: #f0be4e"
                                     th:if="${document.getId() == null}">
                                    <h4 style="font-weight: bold;">ABSENT</h4>
                                </div>
                                <div class="panel-body" th:if="${document.getId() != null}">
                                    <div th:if="${document.getMonthlySum()!=null}">
                                        <span th:text="${'Montly sum: '+document.getMonthlySum()}"></span>
                                    </div>
                                    <div th:if="${document.getCustomText()!=null}">
                                        <span th:text="${'Custom text: '+document.getCustomText()}"></span>
                                    </div>
                                    <ul>
                                        <li style="margin-top: 5px" th:each="file : ${filesByDocument.get(document.getId())}">
                                            <a th:href="${'/files/' + file.getId()}"
                                               th:text="${file.summary}"></a>
                                            <span th:if="${file.hasBeenAnalyzed()}" th:with="analysis=${file.analysis}">
                                                <span class="fa" th:classappend="${analysis.authenticationStatusCssClass}"
                                                      th:text="' ' + ${analysis.authenticationStatus}"></span>
                                                <span class="fa fa-times text-danger" th:if="${analysis.isInWrongCategory}"
                                                > Mauvaise catégorie</span>
                                                <br/>
                                                <span class="small" th:if="${analysis.isNotAuthenticated}">
                                                    <span class="bold">Devrait contenir : </span>
                                                    <span th:text="${analysis.authenticatedContent}"></span>
                                                </span>
                                            </span>
                                        </li>
                                    </ul>
                                    <div th:if="${document.avisDetected}">
                                        - Attention, un avis de situation a été détecté !
                                    </div>
                                </div>
                                <div class="modal" role="dialog" tabindex="-1"
                                     th:id="'deleteModal'+${document.getId()}">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header" style="background: lavender;padding: 10px;">
                                                <h5 class="modal-title bold" style="width: 80%;float: left;">Confirm
                                                    delete</h5>
                                                <button aria-label="Close" class="close" data-dismiss="modal"
                                                        type="button">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body"
                                                 style="background: aliceblue;text-shadow: 0 0 black;">
                                                <p>Are you sure you want delete this document ?</p>
                                            </div>
                                            <div class="modal-footer" style="background: aliceblue;padding: 5px;">
                                                <a class="btn btn-primary"
                                                   style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                   th:href="@{/bo/tenant/delete/document/} + ${document.getId()}"
                                                   th:id="'deleteRef' + ${document.getId()}">Delete</a>
                                                <button class="btn btn-secondary" data-dismiss="modal"
                                                        style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                        type="button">
                                                    Close
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal" role="dialog" tabindex="-1"
                                     th:id="'modalDeleteGuarantor-'+${guarantor.getId()}">
                                    <div class="modal-dialog" role="guarantor">
                                        <div class="modal-content">
                                            <div class="modal-header" style="background: lavender;padding: 10px;">
                                                <h5 class="modal-title bold" style="width: 80%;float: left;">Confirm
                                                    delete</h5>
                                                <button aria-label="Close" class="close" data-dismiss="modal"
                                                        type="button">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body"
                                                 style="background: aliceblue;text-shadow: 0 0 black;">
                                                <p>Are you sure you want delete this guarantor ?</p>
                                            </div>
                                            <div class="modal-footer" style="background: aliceblue;padding: 5px;">
                                                <a class="btn btn-primary"
                                                   style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                   th:href="@{/bo/tenant/delete/guarantor/} + ${guarantor.getId()}">Delete</a>
                                                <button class="btn btn-secondary" data-dismiss="modal"
                                                        style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                        type="button">
                                                    Close
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane" role="tabpanel"
                     th:each="tenant,iter: ${tenants}" th:id="'tenant-message'+${tenant.id}">
                </div>
            </div>
        </div>

    </div>
</div>
</body>
</html>
