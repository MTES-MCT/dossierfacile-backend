<!DOCTYPE html>
<html lang="en"
      layout:decorate="~{bo/layout-bo}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
>
<head>
    <title>DossierFacile</title>
    <link rel="stylesheet" href="/css/apartment-sharing-view.css"/>
</head>
<body>
<div layout:fragment="content" th:remove="tag">

    <div class="row class-message-link">
        <div class="col-md-12 col-lg-12">

            <ul class="nav nav-tabs" role="tablist">

                <li class="nav-item active" role="presentation">
                    <a class="nav-link active"
                       data-bs-toggle="tab"
                       href="#colocatio"
                       data-bs-target="#colocatio"
                       type="button"
                       role="presentation"
                       aria-controls="colocatio"
                       th:text="#{apartmentSharing}"
                    ></a>
                </li>

                <li class="nav-item" role="presentation" th:each="tenant,iter:${tenants}">
                    <a class="nav-link data-tab2"
                       th:id="'badge2' + ${tenant.id}"
                       data-bs-toggle="tab"
                       th:href="'#tenant'+${tenant.id}"
                       th:data-bs-target="'#tenant'+${tenant.id}"
                       type="button"
                       role="tab"
                       aria-controls="mon-dossier"
                       th:attr="data-name=${tenant.id}"
                       th:text="${tenant.getFullName()} ==''? 'locataire ':${tenant.getFullName()}"
                    ></a>
                </li>

                <li class="nav-item" role="presentation" th:each="tenant,iter:${tenants}">
                    <a class="nav-link chat"
                       data-bs-toggle="tab"
                       th:data-bs-target="'#tenant-message'+${tenant.id}"
                       type="button"
                       role="tab"
                       aria-controls="mon-dossier"
                       th:href="'#tenant-message'+${tenant.id}"
                       th:text="'message: '+${tenant.getFullName()}"
                       th:attrappend="data-tenant-id=${tenant.id}"
                    ></a>
                </li>

            </ul>
            <!-- Tab panes -->

            <div class="tab-content">
                <div class="tab-pane show active" id="colocatio" role="tabpanel">
                    <div class="container">
                        <div class="medium-space-separator">
                            <div clas="row">
                                <div class="">
                                    <button class="btn btn-success bo-btn deleteApartmentSharing"
                                            style="color: white;background-color: #f0ad4e;float: right;margin-right: 10px;margin-bottom: 10px;background-color: #d9534f;border-color: #d43f3a;"
                                            th:href="@{/bo/tenant/deleteApartmentSharing/} + ${tenantPrincipal.getId()}"
                                    >Supprimer la colocation
                                    </button>
                                    <a class="btn btn-success bo-btn btnPartner"
                                       style="float: left;background-color: darkcyan;border-color: var(--bs-info-bg-subtle);">
                                        Trigger a partner callback
                                    </a>
                                </div>

                            </div>
                            <div class="modal" id="triggerPart" role="dialog"
                                 tabindex="-1">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header" style="background: #f18686;padding: 10px;">
                                            <h5 class="modal-title bold">Select</h5>
                                            <button aria-label="Close" class="btn-close" data-bs-dismiss="modal"
                                                    type="button"></button>
                                        </div>
                                        <div class="modal-body bg-body-tertiary">
                                            <form method="post"
                                                  style="margin-top: 8px;"
                                                  th:action="@{/bo/tenant/partner/}+${tenantPrincipal.getId()}"
                                                  th:object="${partnerUpdate}">
                                                <label for="action2" style="margin-left: 5px">partner:</label>
                                                <select id="action2" name="action"
                                                        style=" border-radius: 3px; padding-left: 5px !important;padding-right: 5px;"
                                                        th:field="*{partner}">
                                                    <option selected="selected" value="">-----------------</option>
                                                    <option th:each="partner:${partnersList}"
                                                            th:text="${partner.getName()}"
                                                            th:value="${partner.getId()}"></option>
                                                </select>

                                                <div class="modal-footer bg-body-tertiary"
                                                     style="padding: 5px;margin-top: 20px;">
                                                    <button class="btn btn-primary"
                                                            id="hrefPartner" name="submit"
                                                            style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                            type="submit"
                                                            value="submit">
                                                        Submit
                                                    </button>
                                                    <button class="btn btn-secondary" data-bs-dismiss="modal"
                                                            style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                            type="button">
                                                        Cancel
                                                    </button>
                                                </div>
                                            </form>
                                        </div>

                                    </div>
                                </div>
                            </div>
                            <div class="modal" id="deleteTenant" role="dialog"
                                 tabindex="-1">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header" style="background: #f18686;padding: 10px;">
                                            <h5 class="modal-title bold" style="width: 80%;float: left;">Confirm
                                                delete</h5>
                                            <button aria-label="Close" class="btn-close" data-bs-dismiss="modal"
                                                    type="button"></button>
                                        </div>
                                        <div class="modal-body bg-body-tertiary"
                                             style="text-shadow: 0 0 black;">
                                            <p>Are you sure you want delete this tenant ?</p>
                                        </div>
                                        <div class="modal-footer bg-body-tertiary" style="padding: 5px;">
                                            <a class="btn btn-primary"
                                               id="idRef"
                                               style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                               th:href="@{/bo/tenant/delete/tenant/} + ${tenantPrincipal.getId()}">Delete</a>
                                            <button class="btn btn-secondary" data-bs-dismiss="modal"
                                                    style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                    type="button">
                                                Close
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal" id="deleteApartmentSharing" role="dialog"
                                 tabindex="-1">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header" style="background: #f18686;padding: 10px;">
                                            <h5 class="modal-title bold" style="width: 80%;float: left;">
                                                Confirmation
                                            </h5>
                                            <button aria-label="Close" class="btn-close" data-bs-dismiss="modal"
                                                    type="button"></button>
                                        </div>
                                        <div class="modal-body bg-body-tertiary"
                                             style="text-shadow: 0 0 black;">
                                            <p>Êtes-vous sûr de vouloir supprimer ce dossier ainsi que tous ses
                                                candidats ?</p>
                                        </div>
                                        <div class="modal-footer bg-body-tertiary" style="padding: 5px;">
                                            <a class="btn btn-primary"
                                               id="idRefApt"
                                               style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                               th:href="@{/bo/tenant/deleteApartmentSharing/} + ${tenantPrincipal.getId()}">
                                                Oui
                                            </a>
                                            <button class="btn btn-secondary" data-bs-dismiss="modal"
                                                    style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                    type="button">
                                                Annuler
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <table class="table table-striped table-bordered table-hover">
                                <tr>
                                    <td>Statut</td>
                                    <td colspan="2" th:text="${apartmentSharing.getStatus()}"></td>
                                </tr>
                                <tr>
                                    <td>Nombre de locataires</td>
                                    <td colspan="2" th:text="${apartmentSharing.getNumberOfTenants()}"></td>
                                </tr>
                                <tr>
                                    <td>Type d'application</td>
                                    <td colspan="2" th:text="${apartmentSharing.getApplicationType()}"></td>
                                </tr>
                                <tr class="${apartmentSharing.getStatus().name() != 'VALIDATED'}">
                                    <td colspan="3">
                                        Les liens de partage seront accessibles une fois le dossier validé
                                    </td>
                                </tr>
                                <tr th:if="${apartmentSharing.getStatus().name()} == 'VALIDATED'">
                                    <td>Link restricted</td>
                                    <td th:text="${@environment.getProperty('link.domain.document')+'/public-file/' + apartmentSharing.getTokenPublic()}"></td>
                                    <td rowspan="2">
                                        <form th:action="@{/bo/colocation/{id}/tokens/(id=${apartmentSharing.id})}"
                                              th:method="delete">
                                            <button class="btn btn-outline-danger btn-modal-confirm-before-submit"
                                                    type="button">
                                                Regénérer
                                            </button>
                                            <div class="modal" role="dialog" tabindex="-1">
                                                <div class="modal-dialog" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-body">
                                                            <div class="modal-body">
                                                                Voulez-vous regénérer les tokens ?
                                                            </div>

                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary"
                                                                        data-bs-dismiss="modal">Annuler
                                                                </button>
                                                                <button class="btn  btn-primary " type="submit">
                                                                    Valider
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </td>
                                </tr>
                                <tr th:if="${apartmentSharing.getStatus().name()} == 'VALIDATED'">
                                    <td>Link full</td>
                                    <td th:text="${@environment.getProperty('link.domain.document')+'/file/' + apartmentSharing.getToken()}"></td>
                                </tr>

                            </table>
                            <h2>Liste des liens envoyés:</h2>
                            <table class="table table-striped table-bordered table-hover">
                                <tr>
                                    <th>Type</th>
                                    <th>Email</th>
                                    <th>Token</th>
                                    <th>Action</th>
                                </tr>
                                <tr th:each="link : ${apartmentSharing.apartmentSharingLinks}">
                                    <td th:text="${link.linkType}"></td>
                                    <td th:text="${link.email}"></td>
                                    <td th:text="${link.token}"></td>
                                    <td>
                                        <form th:action="@{/bo/colocation/{id}/apartmentSharingLinks/{link_id}(id=${apartmentSharing.id},link_id=${link.id})}"
                                              th:method="delete">
                                            <button class="btn btn-outline-danger btn-modal-confirm-before-submit"
                                                    type="button">
                                                Supprimer
                                            </button>
                                            <div class="modal" role="dialog" tabindex="-1">
                                                <div class="modal-dialog" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-body">
                                                            <div class="modal-body">
                                                                Voulez-vous supprimer le lien?
                                                            </div>

                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary"
                                                                        data-bs-dismiss="modal">Annuler
                                                                </button>
                                                                <button class="btn  btn-primary " type="submit">
                                                                    Valider
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="tab-pane data-tab2" role="tabpanel"
                     th:each="tenant,iter: ${tenants}" th:id="'tenant'+${tenant.id}">
                    <div class="container">
                        <div class="medium-space-separator">
                            <div class="row">
                                <div class="col-md-5">
                                    <form
                                            class="form-inline btn-validate-form"
                                            style="float: left; margin-right: 10px;"
                                            th:action="@{/bo/tenant/} + ${tenant.getId()} + '/validate'"
                                            th:attr="data-id=${tenant.getId()},data-idApt=${tenant.getApartmentSharing().getId()}"
                                            th:id="'form-validated' + ${tenant.getId()}"
                                            th:method="post">
                                        <button class="btn btn-success bo-btn" name="action" type="submit"
                                                value="delete">
                                            Valider le dossier
                                        </button>
                                    </form>
                                    <form
                                            class="form-inline btn-denied-form"
                                            style="float: left; margin-right: 10px;"
                                            th:action="@{/bo/tenant/} + ${tenant.getId()} + '/decline'"
                                            th:attr="data-id=${tenant.getId()},data-idApt=${tenant.getApartmentSharing().getId()}"
                                            th:id="'form-denied' + ${tenant.getId()}"
                                            th:method="post">
                                        <button class="btn btn-danger bo-btn" name="action" type="submit">
                                            Refuser le dossier
                                        </button>
                                    </form>

                                    <a class="btn btn-success bo-btn" data-bs-toggle="modal"
                                       style="background-color: darkcyan;"
                                       th:data-bs-target="'#target'+${tenant.getId()}">Logs</a>

                                </div>
                                <div class="col-md-7">

                                    <a class="btn btn-success bo-btn"
                                       style="float: right;"
                                       th:href="@{/bo/tenant/} + ${tenant.getId()} + '/processFile'">
                                        Traiter les documents
                                    </a>
                                    <div th:if="${ tenant.getTenantType().toString() == 'JOIN' }">
                                        <a class="btn btn-warning bo-btn"
                                           style="margin-right: 10px;float: right"
                                           th:attrappend="data-id=${tenant.getId()}"
                                           th:href="@{/bo/tenant/setAsTenantCreate/} + ${tenant.getId()}"
                                           th:text="'Fixer comme locataire principal'"
                                        ></a>
                                    </div>
                                    <div th:if="${ tenant.getTenantType().toString() != 'CREATE'}">
                                        <a class="btn btn-danger bo-btn btn-deleteCotenant"
                                           style="margin-right: 10px;float: right"
                                           th:attrappend="data-id=${tenant.getId()}"
                                           th:href="@{/bo/tenant/deleteCoTenant/} + ${tenant.getId()}"
                                           th:text="'Supprimer le colocataire'"
                                        ></a>
                                    </div>
                                </div>

                                <div aria-hidden="true" aria-labelledby="exampleModalScrollableTitle" class="modal fade"
                                     role="dialog"
                                     tabindex="-1" th:id="'target'+${tenant.getId()}">
                                    <div class="modal-dialog modal-dialog-scrollable" role="document"
                                         style="--bs-modal-width: 600px">
                                        <div class="modal-content">
                                            <div class="modal-header" style="background: cadetblue;">
                                                <h3 class="modal-title" id="exampleModalScrollableTitle"
                                                    style="text-align: -webkit-center;"
                                                    th:text="'Logs: ' + ${tenant.getFullName()}"></h3>
                                                <button aria-label="Close" class="btn-close" data-bs-dismiss="modal"
                                                        type="button"></button>
                                            </div>
                                            <div class="modal-body bg-body-tertiary"
                                                 style="max-height: 80vh;overflow-y: auto;height: auto">
                                                <div class="bg-warning-subtle"
                                                     style="display: grid; padding: 7px;margin-bottom: 10px;"
                                                     th:each="log: ${logser.getLogByTenantId(tenant.getId())}">
                                                    <div style="font-weight: bold;"
                                                         th:text="${log.getLogType()} + ${ (log.getOperatorId() != null)? ' by opId: ' + log.getOperatorId() : ''} + ${log.getLogDetails() != null && log.getLogDetails().get('editionType') != null ? ' : DOCUMENT ' + (log.getLogDetails().get('editionType').asText().equals('ADD') ? 'ADDED' : 'DELETED'): ''}">
                                                    </div>
                                                    <span th:if="${log != null && log.getLogDetails() != null && log.getLogDetails().get('documentCategory') != null && log.getLogDetails().get('documentSubCategory') != null}"
                                                          class="bold" style="font-size: 14px">
                                                        <span th:if="${log.getLogDetails().get('guarantorId') != null}">GUARANTOR - </span>
                                                        <span th:text="${log.getLogDetails().get('documentCategory').asText()}"></span> -
                                                        <span th:text="${log.getLogDetails().get('documentSubCategory').asText()}"></span>
                                                    </span>
                                                    <span
                                                            th:text="'date: ' + ${log.getCreationDateTime().getYear()} + '-' + ${log.getCreationDateTime().getMonthValue()} + '-' + ${log.getCreationDateTime().getDayOfMonth()} + ' ' + ${log.getCreationDateTime().getHour()} + ':' + ${log.getCreationDateTime().getMinute()} + ':' + ${log.getCreationDateTime().getSecond()}">
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="modal-footer bg-body-tertiary">
                                                <button class="btn btn-secondary" data-bs-dismiss="modal"
                                                        style="font-size: initial;color: white;background-color: #0069d9;"
                                                        type="button">
                                                    Close
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="modal" role="dialog" tabindex="-1"
                                     th:id="'deleteCotenant'+${tenant.getId()}">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content bg-info-subtle">
                                            <div class="modal-header" style="padding: 10px;">
                                                <h5 class="modal-title bold" style="width: 80%;float: left;">
                                                    Confirmation
                                                </h5>
                                                <button aria-label="Close" class="btn-close" data-bs-dismiss="modal"
                                                        type="button"></button>
                                            </div>
                                            <div class="modal-body bg-body-tertiary"
                                                 style="text-shadow: 0 0 black;">
                                                <p>
                                                    Êtes-vous sûr de vouloir supprimer le dossier de
                                                    <span th:text="${tenant.getFullName()}"></span> ?
                                                </p>
                                            </div>
                                            <div class="modal-footer bg-body-tertiary" style="padding: 5px;">
                                                <a class="btn btn-primary"
                                                   style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                   th:href="@{/bo/tenant/deleteCoTenant/} + ${tenant.getId()}"
                                                   th:id="'deleteRefCo' + ${tenant.getId()}">
                                                    Oui
                                                </a>
                                                <button class="btn btn-secondary" data-bs-dismiss="modal"
                                                        style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                        type="button">
                                                    Annuler
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="margin-top: 0.5em">
                                <div class="col-md-10">
                                    <a class="btn btn-warning bo-btn" data-bs-toggle="modal"
                                       th:data-bs-target="'#add-comment-'+${tenant.getId()}">
                                        <span th:text="${T(org.apache.commons.lang3.StringUtils).isBlank(tenant.getOperatorComment())} ? 'Ajouter un commentaire' : 'Editer le commentaire'"></span>
                                    </a>
                                </div>
                                <div class="modal fade" th:id="'add-comment-' + ${tenant.getId()}" role="dialog"
                                     tabindex="-1">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title bold" style="width: 80%;float: left;">
                                                    Précisions concernant le traitement du dossier
                                                </h5>
                                                <button aria-label="Close" class="btn-close" data-bs-dismiss="modal"
                                                        type="button"></button>
                                            </div>

                                            <form method="post" th:action="@{/bo/tenant/__${tenant.getId()}__/comment}">
                                                <div class="modal-body">
                                                    <textarea id="comment" name="comment" class="input" rows="6"
                                                              type="text"
                                                              th:text="${tenant.getOperatorComment()}"></textarea>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="submit" class="btn btn-info btn-save"
                                                            style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;">
                                                        Sauvegarder
                                                    </button>
                                                    <button class="btn btn-secondary" data-bs-dismiss="modal"
                                                            style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                            type="button">
                                                        Annuler
                                                    </button>
                                                </div>
                                            </form>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="table-responsive">

                            <table class="table table-striped table-bordered table-hover"
                                   th:with="partners=${partnerListByTenant.getNamesOfPartnerByTenantId(tenant.getId())}">
                                <tr th:if="${tenant.getOperatorComment() != null && !tenant.getOperatorComment().isEmpty()}">
                                    <td style="width: 25%">⚠️ Commentaire opérateur</td>
                                    <td th:text="${tenant.getOperatorComment()}"></td>
                                </tr>
                                <tr th:if="${!partners.isEmpty()}">
                                    <td>Partenaire(s)</td>
                                    <td>
                                        <ul>
                                            <li
                                                    th:each="item : ${partners}"
                                                    th:text="${item}"
                                            >
                                            </li>
                                        </ul>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <div class="table-responsive">

                            <table class="table table-striped table-bordered table-hover">
                                <tr>
                                    <td style="width: 25%">Tenant Id</td>
                                    <td th:text="${tenant.getId()}"></td>
                                </tr>
                                <tr>
                                    <td>Prénom</td>
                                    <td th:text="${tenant.getFirstName()}"></td>
                                </tr>
                                <tr>
                                    <td>Nom</td>
                                    <td th:text="${tenant.getLastName()}"></td>
                                </tr>
                                <tr>
                                    <td>Nom d'usage</td>
                                    <td th:text="${tenant.getPreferredName()}"></td>
                                </tr>
                                <tr>
                                    <td>Email</td>
                                    <td>
                                        <span th:if="${ tenant.getFranceConnect() == true }"><img
                                                src="/assets/images/franceconnect-icon.png" height="22px"
                                                alt="isFC"/></span>
                                        <span th:text="${tenant.getEmail()}"></span>
                                        <span th:with="verified=${tenantService.hasVerifiedEmailIfExistsInKeycloak(tenant)}">
                                            <span class="fa"
                                                  th:if="${verified != null}"
                                                  th:classappend="${verified} ? 'fa-check text-success' : 'fa-times text-danger'"
                                                  th:text="${verified} ? ' Vérifié' : ' Non vérifié'">
                                            </span>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Code postal</td>
                                    <td>
                                        <span th:text="${tenant.getZipCode()}"></span>
                                        <span th:if="${tenant.abroad == true}">À l'étranger</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Type de compte</td>
                                    <td th:text="${tenant.getTenantType().toString() == 'CREATE' ?
                                        'Utilisateur principal (initiateur du dossier)' :
                                        'Utilisateur invité (pas initiateur du dossier)'}">
                                    </td>
                                </tr>
                                <tr>
                                    <td>Statut du dossier</td>
                                    <td th:text="${tenant.getStatus()}"></td>
                                </tr>
                            </table>
                        </div>

                        <div class="table-responsive" th:unless="${tenant.getGuarantors().isEmpty()}">

                            <table class="table table-striped table-bordered table-hover">
                                <tr>
                                    <td>Type de garant</td>
                                    <td>Prénom</td>
                                    <td>Nom</td>
                                    <td>Nom de la personne morale</td>
                                </tr>
                                <tr th:each="guarantor : ${tenant.getGuarantors()}">
                                    <td th:text="${guarantor.getTypeGuarantor()}"></td>
                                    <td th:text="${guarantor.getFirstName()}"></td>
                                    <td th:text="${guarantor.getLastName()}"></td>
                                    <td th:text="${guarantor.getLegalPersonName()}"></td>
                                </tr>
                            </table>
                        </div>

                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover">
                                <tr>
                                    <td style="width: 20%">Déclaration sur l'honneur</td>
                                    <td th:text="${tenant.getHonorDeclaration()}"
                                        th:style="${tenant.getHonorDeclaration() == false ? 'color: red;' : ''}"></td>
                                </tr>
                                <tr>
                                    <td>Mot du locataire</td>
                                    <td th:text="${tenant.getClarification()}"></td>
                                </tr>
                            </table>
                        </div>

                        <div class="medium-space-separator" id="update-status">
                            <div class="card panel-primary mb-3"
                                 th:each="document,iter : ${tenantService.getAllDocumentCategories(tenant)}">

                                <div class="card-header">

                                    <div class="card-title" th:if="${document.getId() == null}">
                                        <span>Category:
                                            <span
                                                    th:text="${document.getDocumentCategory().name()}">
                                            </span>
                                        </span>
                                    </div>

                                    <div class="card-title"
                                         th:if="${document.getId() != null} and ${document.getWatermarkFile() == null}">
                                        <span>Category:
                                            <span
                                                    th:text="${document.getDocumentCategory().name()}">
                                            </span>
                                        </span>
                                        <span> Subcategory:
                                            <span
                                                    th:text="${document.getDocumentSubCategory().name()}">
                                            </span>
                                        </span>

                                        <a class="btn btn-sm btn-warning btn-right-pull pull-right deleteButton badge bg-warning text-dark"
                                           th:attrappend="data-id=${document.id}"
                                           th:href="@{/bo/tenant/delete/document/} + ${document.getId()}">
                                            DELETE
                                        </a>

                                        <span class="btn-right-pull badge bg-success pull-right"
                                              style="color: black;"
                                              th:if="${document.getDocumentStatus().name()=='VALIDATED'}"
                                              th:text="${document.getDocumentStatus()}">
                                        </span>
                                        <span class="btn-right-pull badge bg-danger pull-right" style="color: black;"
                                              th:if="${document.getDocumentStatus().name()=='DECLINED'}"
                                              th:text="${document.getDocumentStatus()}">
                                        </span>
                                        <span class="btn-right-pull badge bg-info pull-right" style="color: black;"
                                              th:if="${document.getDocumentStatus().name()=='TO_PROCESS'}"
                                              th:text="${document.getDocumentStatus()}">
                                        </span>

                                        <div class="container" style="margin-top: 5px; padding-left: 0">
                                            <div class="container" style="margin-top: 5px; padding-left: 0">
                                                PDF status:
                                                <span th:if="${document.getLastModifiedDate() == null || document.getLastModifiedDate().plusMinutes(30).isBefore(now)}"
                                                      style="color:white; background-color: red; font-weight: bolder">
                                                        FAILED
                                                </span>
                                                <span th:unless="${document.getLastModifiedDate() == null || document.getLastModifiedDate().plusMinutes(30).isBefore(now)}"
                                                      style="color:white; background-color: orange; font-weight: bolder">
                                                        IN_PROGRESS
                                                </span>

                                                <a class="btn btn-light btn-sm ms-2"
                                                   th:href="@{/bo/regeneratePdfDocument/} + ${document.getId()}">Update
                                                    PDF</a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="card-title"
                                         th:if="${document.getId() != null} and ${document.getWatermarkFile() != null}">
                                        <span>Category:
                                            <span
                                                    th:text="${document.getDocumentCategory().name()}">
                                            </span>
                                        </span>
                                        <span> Subcategory:
                                            <span
                                                    th:text="${document.getDocumentSubCategory().name()}">
                                            </span>
                                        </span>

                                        <a class="btn btn-sm btn-warning btn-right-pull pull-right deleteButton badge bg-warning text-dark"
                                           th:attrappend="data-id=${document.id}"

                                           th:href="@{/bo/tenant/delete/document/} + ${document.getId()}"
                                        >DELETE
                                        </a>

                                        <span class="btn-right-pull badge bg-success pull-right"
                                              style="color: black;"
                                              th:if="${document.getDocumentStatus().name()=='VALIDATED'}"
                                              th:text="${document.getDocumentStatus()}">
                                        </span>
                                        <span class="btn-right-pull badge bg-danger pull-right" style="color: black;"
                                              th:if="${document.getDocumentStatus().name()=='DECLINED'}"
                                              th:text="${document.getDocumentStatus()}">
                                        </span>
                                        <span class="btn-right-pull badge bg-info pull-right" style="color: black;"
                                              th:if="${document.getDocumentStatus().name()=='TO_PROCESS'}"
                                              th:text="${document.getDocumentStatus()}">
                                        </span>

                                        <div class="container" style="display: flex; margin-top: 5px">
                                            <form method="get" style="margin-top: 8px;"
                                                  th:action="@{/bo/tenant/status/} + ${document.getId()}"
                                                  th:id="'form-change-document-status' + ${document.getId()}"
                                                  th:object="${messageDTO}">
                                                <label for="action"
                                                       style="FONT-SIZE:revert;color: white;">Change status:</label>
                                                <select id="action" name="action"
                                                        style="font-size: smaller;"
                                                        th:attr="document-id=${document.getId()}"
                                                        th:class="'select-change-document-status'"
                                                        th:field="*{message}">
                                                    <option value="">-- SELECT --</option>
                                                    <option th:value="DECLINED">DECLINED</option>
                                                    <option th:value="TO_PROCESS">TO_PROCESS</option>
                                                    <option th:value="VALIDATED">VALIDATED</option>
                                                </select>
                                            </form>

                                            <a class="btn btn-light btn-sm ms-2"
                                               th:href="@{/bo/regeneratePdfDocument/} + ${document.getId()}">Update
                                                Document PDF</a>

                                            <a class="btn btn-light btn-sm ms-2"
                                               th:href="${'/documents/'+ document.getName()}" target="_blank">See
                                                Document PDF</a>
                                        </div>
                                    </div>

                                </div>

                                <div class="card-body" style="text-align: -webkit-center;background: #f0be4e"
                                     th:if="${document.getId() == null}">
                                    <div style="font-weight: bold;">ABSENT</div>
                                </div>

                                <div class="card-body" th:if="${document.getId() != null}">
                                    <div th:if="${document.getMonthlySum()!=null}">
                                        <span th:text="${'Montly sum: '+document.getMonthlySum()}"></span>
                                    </div>
                                    <div th:if="${document.getCustomText()!=null}">
                                        <span th:text="${'Custom text: '+document.getCustomText()}"></span>
                                    </div>
                                    <ul>
                                        <li style="margin-top: 5px"
                                            th:each="file : ${filesByDocument.get(document.getId())}">
                                            <a target="_blank" rel="noopener"
                                               th:href="${'/files/' + file.getId()}"
                                               th:text="${file.summary}"></a>
                                            <span th:if="${file.hasBeenAnalyzed()}" th:with="analysis=${file.analysis}">
                                                <span class="fa"
                                                      th:classappend="${analysis.authenticationStatusCssClass}"
                                                      th:text="' ' + ${analysis.authenticationStatus}"></span>
                                                <span class="fa fa-times text-danger"
                                                      th:if="${analysis.isInWrongCategory}"
                                                > Mauvaise catégorie</span>
                                                <br/>
                                                <span class="small" th:if="${analysis.isNotAuthenticated}">
                                                    <span class="bold">Devrait contenir : </span>
                                                    <span th:text="${analysis.authenticatedContent}"></span>
                                                </span>
                                            </span>
                                        </li>
                                    </ul>
                                    <div th:if="${document.documentAnalysisReport != null}"
                                         th:class="${'prevalidation-background-' + document.documentAnalysisReport.analysisStatus}"
                                    >
                                        <div th:replace="~{bo/fragments/document-analysis :: analysis(
                                            report=${document.documentAnalysisReport},
                                            documentRuleLevel=${documentRuleLevel},
                                            uid=${(document.id != null) ? 'doc-' + document.id : 'doc-' + iter.index}
                                          )}">
                                        </div>

                                    </div>
                                    <div th:if="${document.avisDetected}">
                                        - Attention, un avis de situation a été détecté !
                                    </div>
                                </div>
                                <div class="modal" role="dialog" tabindex="-1"
                                     th:id="'deleteModal'+${document.getId()}">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content bg-info-subtle">
                                            <div class="modal-header" style="padding: 10px;">
                                                <h5 class="modal-title bold" style="width: 80%;float: left;">
                                                    Confirmation
                                                </h5>
                                                <button aria-label="Close" class="btn-close" data-bs-dismiss="modal"
                                                        type="button"></button>
                                            </div>
                                            <div class="modal-body bg-body-tertiary"
                                                 style="text-shadow: 0 0 black;">
                                                <p>Êtes-vous sûr de vouloir supprimer ce document ?</p>
                                            </div>
                                            <div class="modal-footer bg-body-tertiary" style="padding: 5px;">
                                                <a class="btn btn-primary"
                                                   style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                   th:href="@{/bo/tenant/delete/document/} + ${document.getId()}"
                                                   th:id="'deleteRef' + ${document.getId()}">
                                                    Oui
                                                </a>
                                                <button class="btn btn-secondary" data-bs-dismiss="modal"
                                                        style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                        type="button">
                                                    Annuler
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h3 th:unless="${tenant.getGuarantors().isEmpty()}">Garants</h3>
                        <div class="medium-space-separator" th:each="guarantor : ${tenant.getGuarantors()}">
                            <div>
                                <span th:text="${guarantor.getTypeGuarantor()}"></span>
                                <a class="btn btn-danger bo-btn btn-deleteGuarantor"
                                   style="margin-right: 10px; margin-left: 20px; margin-top: -5px"
                                   th:attr="guarantor-id=${guarantor.getId()}"
                                   th:text="'Supprimer le garant'"
                                ></a>
                            </div>
                            <div class="card panel-primary mb-3"
                                 th:each="document,iter : ${tenantService.getAllDocumentCategoriesGuarantor(guarantor)}">
                                <div class="card-header">
                                    <div class="card-title" th:if="${ document.getId() == null }">
                                        <span>Category:
                                            <span
                                                    th:text="${document.getDocumentCategory().name()}">
                                            </span>
                                        </span>
                                    </div>

                                    <div class="card-title"
                                         th:if="${document.getId() != null} and ${document.getWatermarkFile() == null}">
                                        <span>Category:
                                            <span
                                                    th:text="${document.getDocumentCategory().name()}">
                                            </span>
                                        </span>
                                        <span> Subcategory:
                                            <span
                                                    th:text="${document.getDocumentSubCategory().name()}">
                                            </span>
                                        </span>

                                        <a class="btn btn-sm btn-warning btn-right-pull pull-right deleteButton badge bg-warning text-dark"
                                           th:attrappend="data-id=${document.id}"

                                           th:href="@{/bo/tenant/delete/document/} + ${document.getId()}"
                                        >DELETE
                                        </a>

                                        <span class="btn-right-pull badge bg-success pull-right"
                                              style="color: black;"
                                              th:if="${document.getDocumentStatus().name()=='VALIDATED'}"
                                              th:text="${document.getDocumentStatus()}">
                                        </span>
                                        <span class="btn-right-pull badge bg-danger pull-right" style="color: black;"
                                              th:if="${document.getDocumentStatus().name()=='DECLINED'}"
                                              th:text="${document.getDocumentStatus()}">
                                        </span>
                                        <span class="btn-right-pull badge bg-info pull-right" style="color: black;"
                                              th:if="${document.getDocumentStatus().name()=='TO_PROCESS'}"
                                              th:text="${document.getDocumentStatus()}">
                                        </span>

                                        <div class="container" style="margin-top: 5px; padding-left: 0">
                                            PDF status:
                                            <span th:if="${document.getLastModifiedDate() == null || document.getLastModifiedDate().plusMinutes(30).isBefore(now)}"
                                                  style="color:white; background-color: red; font-weight: bolder">
                                                    FAILED
                                            </span>
                                            <span th:unless="${document.getLastModifiedDate() == null || document.getLastModifiedDate().plusMinutes(30).isBefore(now)}"
                                                  style="color:white; background-color: orange; font-weight: bolder">
                                                    IN_PROGRESS
                                            </span>

                                            <a class="btn btn-secondary btn-sm ms-2"
                                               th:href="@{/bo/regeneratePdfDocument/} + ${document.getId()}">Update
                                                PDF</a>

                                        </div>
                                    </div>

                                    <div class="card-title"
                                         th:if="${ document.getId() != null} and ${document.getWatermarkFile() != null}">
                                        <span>Category:
                                            <span
                                                    th:text="${document.getDocumentCategory().name()}">
                                            </span>
                                        </span>
                                        <span> Subcategory:
                                            <span
                                                    th:text="${document.getDocumentSubCategory().name()}">
                                            </span>
                                        </span>

                                        <a class="btn btn-sm btn-warning btn-right-pull pull-right deleteButton badge bg-warning text-dark"
                                           th:attrappend="data-id=${document.id}"

                                           th:href="@{/bo/tenant/delete/document/} + ${document.getId()}"
                                        >DELETE
                                        </a>

                                        <span class="btn-right-pull badge bg-success pull-right"
                                              style="color: black;"
                                              th:if="${document.getDocumentStatus().name()=='VALIDATED'}"
                                              th:text="${document.getDocumentStatus()}">
                                        </span>
                                        <span class="btn-right-pull badge bg-danger pull-right" style="color: black;"
                                              th:if="${document.getDocumentStatus().name()=='DECLINED'}"
                                              th:text="${document.getDocumentStatus()}">
                                        </span>
                                        <span class="btn-right-pull badge bg-info pull-right" style="color: black;"
                                              th:if="${document.getDocumentStatus().name()=='TO_PROCESS'}"
                                              th:text="${document.getDocumentStatus()}">
                                        </span>

                                        <div class="container" style="display: flex; margin-top: 5px">
                                            <form method="get" style="margin-top: 8px;"
                                                  th:action="@{/bo/tenant/status/} + ${document.getId()}"
                                                  th:id="'form-change-document-status' + ${document.getId()}"
                                                  th:object="${messageDTO}">
                                                <label for="action1"
                                                       style="FONT-SIZE:revert;color: white;">Change status:</label>
                                                <select id="action1" name="action"
                                                        style="font-size: smaller;"
                                                        th:attr="document-id=${document.getId()}"
                                                        th:class="'select-change-document-status'"
                                                        th:field="*{message}">
                                                    <option value="">-- SELECT --</option>
                                                    <option th:value="DECLINED">DECLINED</option>
                                                    <option th:value="TO_PROCESS">TO_PROCESS</option>
                                                    <option th:value="VALIDATED">VALIDATED</option>
                                                </select>
                                            </form>

                                            <a class="btn btn-light btn-sm ms-2"
                                               th:href="@{/bo/regeneratePdfDocument/} + ${document.getId()}">Update
                                                Document PDF</a>

                                            <a class="btn btn-light btn-sm ms-2"
                                               th:href="${'/documents/'+ document.getName()}" target="_blank">See
                                                Document PDF</a>
                                        </div>
                                    </div>

                                </div>
                                <div class="card-body" style="text-align: -webkit-center;background: #f0be4e"
                                     th:if="${document.getId() == null}">
                                    <div style="font-weight: bold;">ABSENT</div>
                                </div>
                                <div class="card-body" th:if="${document.getId() != null}">
                                    <div th:if="${document.getMonthlySum()!=null}">
                                        <span th:text="${'Montly sum: '+document.getMonthlySum()}"></span>
                                    </div>
                                    <div th:if="${document.getCustomText()!=null}">
                                        <span th:text="${'Custom text: '+document.getCustomText()}"></span>
                                    </div>
                                    <ul>
                                        <li style="margin-top: 5px"
                                            th:each="file : ${filesByDocument.get(document.getId())}">
                                            <a target="_blank" rel="noopener"
                                               th:href="${'/files/' + file.getId()}"
                                               th:text="${file.summary}"></a>
                                            <span th:if="${file.hasBeenAnalyzed()}" th:with="analysis=${file.analysis}">
                                                <span class="fa"
                                                      th:classappend="${analysis.authenticationStatusCssClass}"
                                                      th:text="' ' + ${analysis.authenticationStatus}"></span>
                                                <span class="fa fa-times text-danger"
                                                      th:if="${analysis.isInWrongCategory}"
                                                > Mauvaise catégorie</span>
                                                <br/>
                                                <span class="small" th:if="${analysis.isNotAuthenticated}">
                                                    <span class="bold">Devrait contenir : </span>
                                                    <span th:text="${analysis.authenticatedContent}"></span>
                                                </span>
                                            </span>
                                        </li>
                                    </ul>
                                    <div th:if="${document.documentAnalysisReport != null}"
                                         th:class="${'prevalidation-background-' + document.documentAnalysisReport.analysisStatus}"
                                    >
                                        <div th:replace="~{bo/fragments/document-analysis :: analysis(
                                            report=${document.documentAnalysisReport},
                                            documentRuleLevel=${documentRuleLevel},
                                            uid=${(document.id != null) ? 'doc-' + document.id : 'doc-' + iter.index}
                                          )}">
                                        </div>

                                    </div>
                                    <div th:if="${document.avisDetected}">
                                        - Attention, un avis de situation a été détecté !
                                    </div>
                                </div>
                                <div class="modal" role="dialog" tabindex="-1"
                                     th:id="'deleteModal'+${document.getId()}">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content bg-info-subtle">
                                            <div class="modal-header" style="padding: 10px;">
                                                <h5 class="modal-title bold" style="width: 80%;float: left;">Confirm
                                                    delete</h5>
                                                <button aria-label="Close" class="btn-close" data-bs-dismiss="modal"
                                                        type="button"></button>
                                            </div>
                                            <div class="modal-body bg-body-tertiary"
                                                 style="text-shadow: 0 0 black;">
                                                <p>Are you sure you want delete this document ?</p>
                                            </div>
                                            <div class="modal-footer bg-body-tertiary" style="padding: 5px;">
                                                <a class="btn btn-primary"
                                                   style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                   th:href="@{/bo/tenant/delete/document/} + ${document.getId()}"
                                                   th:id="'deleteRef' + ${document.getId()}">Delete</a>
                                                <button class="btn btn-secondary" data-bs-dismiss="modal"
                                                        style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                        type="button">
                                                    Close
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal" role="dialog" tabindex="-1"
                                     th:id="'modalDeleteGuarantor-'+${guarantor.getId()}">
                                    <div class="modal-dialog" role="guarantor">
                                        <div class="modal-content bg-info-subtle">
                                            <div class="modal-header" style="padding: 10px;">
                                                <h5 class="modal-title bold" style="width: 80%;float: left;">Confirm
                                                    delete</h5>
                                                <button aria-label="Close" class="btn-close" data-bs-dismiss="modal"
                                                        type="button"></button>
                                            </div>
                                            <div class="modal-body bg-body-tertiary"
                                                 style="text-shadow: 0 0 black;">
                                                <p>Are you sure you want delete this guarantor ?</p>
                                            </div>
                                            <div class="modal-footer bg-body-tertiary" style="padding: 5px;">
                                                <a class="btn btn-primary"
                                                   style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                   th:href="@{/bo/tenant/delete/guarantor/} + ${guarantor.getId()}">Delete</a>
                                                <button class="btn btn-secondary" data-bs-dismiss="modal"
                                                        style="border-radius: 50px;font-size: 15px;line-height: 1;padding: 5px 8px 7px;"
                                                        type="button">
                                                    Close
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane" role="tabpanel"
                     th:each="tenant,iter: ${tenants}" th:id="'tenant-message'+${tenant.id}">
                </div>
            </div>
        </div>

    </div>
</div>
</body>
</html>
